{"version":3,"file":"default-node_modules_dontcode_plugin-common_fesm2020_dontcode-plugin-common_mjs.js","mappings":"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","sources":["./node_modules/rxjs/src/internal/ReplaySubject.ts","./node_modules/rxjs/src/internal/Subject.ts","./node_modules/rxjs/src/internal/firstValueFrom.ts","./node_modules/rxjs/src/internal/observable/empty.ts","./node_modules/rxjs/src/internal/observable/of.ts","./node_modules/rxjs/src/internal/operators/catchError.ts","./node_modules/rxjs/src/internal/operators/takeLast.ts","./node_modules/rxjs/src/internal/scheduler/dateTimestampProvider.ts","./node_modules/rxjs/src/internal/util/EmptyError.ts","./node_modules/rxjs/src/internal/util/ObjectUnsubscribedError.ts","./node_modules/rxjs/src/internal/util/args.ts","./libs/common/src/lib/common-ui/abstract-dynamic-component.ts","./libs/common/src/lib/common-ui/abstract-reference.component.html","./libs/common/src/lib/common-global/globals.ts","./libs/common/src/lib/common-dynamic/component-loader.service.ts","./libs/common/src/lib/common-ui/abstract-dynamic-loader-component.ts","./libs/common/src/lib/common-handler/plugin-handler-helper.ts","./libs/common/src/lib/common-ui/plugin-base.component.ts","./libs/common/src/lib/common-ui/pipes/beautifier.pipe.ts","./libs/common/src/lib/common-ui/template-list.ts","./libs/common/src/lib/common-ui/dynamic-event.ts","./libs/common/src/lib/common-ui/abstract-reference.component.ts","./libs/common/src/lib/common-handler/abstract-plugin-handler.ts","./libs/common/src/lib/common-storage/entity-store.service.ts","./libs/common/src/lib/common-values/value.service.ts","./libs/common/src/lib/common-config/common-lib-config.ts","./libs/common/src/lib/common-config/common-config.service.ts","./libs/common/src/lib/plugin-common.module.ts","./libs/common/src/lib/common-test/common-test-manager.ts","./libs/common/src/lib/plugin-common-test.module.ts","./libs/common/src/dontcode-plugin-common.ts","./node_modules/async-mutex/index.mjs","./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"],"sourcesContent":["import { Subject } from './Subject';\nimport { TimestampProvider } from './types';\nimport { Subscriber } from './Subscriber';\nimport { Subscription } from './Subscription';\nimport { dateTimestampProvider } from './scheduler/dateTimestampProvider';\n\n/**\n * A variant of {@link Subject} that \"replays\" old values to new subscribers by emitting them when they first subscribe.\n *\n * `ReplaySubject` has an internal buffer that will store a specified number of values that it has observed. Like `Subject`,\n * `ReplaySubject` \"observes\" values by having them passed to its `next` method. When it observes a value, it will store that\n * value for a time determined by the configuration of the `ReplaySubject`, as passed to its constructor.\n *\n * When a new subscriber subscribes to the `ReplaySubject` instance, it will synchronously emit all values in its buffer in\n * a First-In-First-Out (FIFO) manner. The `ReplaySubject` will also complete, if it has observed completion; and it will\n * error if it has observed an error.\n *\n * There are two main configuration items to be concerned with:\n *\n * 1. `bufferSize` - This will determine how many items are stored in the buffer, defaults to infinite.\n * 2. `windowTime` - The amount of time to hold a value in the buffer before removing it from the buffer.\n *\n * Both configurations may exist simultaneously. So if you would like to buffer a maximum of 3 values, as long as the values\n * are less than 2 seconds old, you could do so with a `new ReplaySubject(3, 2000)`.\n *\n * ### Differences with BehaviorSubject\n *\n * `BehaviorSubject` is similar to `new ReplaySubject(1)`, with a couple of exceptions:\n *\n * 1. `BehaviorSubject` comes \"primed\" with a single value upon construction.\n * 2. `ReplaySubject` will replay values, even after observing an error, where `BehaviorSubject` will not.\n *\n * @see {@link Subject}\n * @see {@link BehaviorSubject}\n * @see {@link shareReplay}\n */\nexport class ReplaySubject<T> extends Subject<T> {\n  private _buffer: (T | number)[] = [];\n  private _infiniteTimeWindow = true;\n\n  /**\n   * @param bufferSize The size of the buffer to replay on subscription\n   * @param windowTime The amount of time the buffered items will stay buffered\n   * @param timestampProvider An object with a `now()` method that provides the current timestamp. This is used to\n   * calculate the amount of time something has been buffered.\n   */\n  constructor(\n    private _bufferSize = Infinity,\n    private _windowTime = Infinity,\n    private _timestampProvider: TimestampProvider = dateTimestampProvider\n  ) {\n    super();\n    this._infiniteTimeWindow = _windowTime === Infinity;\n    this._bufferSize = Math.max(1, _bufferSize);\n    this._windowTime = Math.max(1, _windowTime);\n  }\n\n  next(value: T): void {\n    const { isStopped, _buffer, _infiniteTimeWindow, _timestampProvider, _windowTime } = this;\n    if (!isStopped) {\n      _buffer.push(value);\n      !_infiniteTimeWindow && _buffer.push(_timestampProvider.now() + _windowTime);\n    }\n    this._trimBuffer();\n    super.next(value);\n  }\n\n  /** @internal */\n  protected _subscribe(subscriber: Subscriber<T>): Subscription {\n    this._throwIfClosed();\n    this._trimBuffer();\n\n    const subscription = this._innerSubscribe(subscriber);\n\n    const { _infiniteTimeWindow, _buffer } = this;\n    // We use a copy here, so reentrant code does not mutate our array while we're\n    // emitting it to a new subscriber.\n    const copy = _buffer.slice();\n    for (let i = 0; i < copy.length && !subscriber.closed; i += _infiniteTimeWindow ? 1 : 2) {\n      subscriber.next(copy[i] as T);\n    }\n\n    this._checkFinalizedStatuses(subscriber);\n\n    return subscription;\n  }\n\n  private _trimBuffer() {\n    const { _bufferSize, _timestampProvider, _buffer, _infiniteTimeWindow } = this;\n    // If we don't have an infinite buffer size, and we're over the length,\n    // use splice to truncate the old buffer values off. Note that we have to\n    // double the size for instances where we're not using an infinite time window\n    // because we're storing the values and the timestamps in the same array.\n    const adjustedBufferSize = (_infiniteTimeWindow ? 1 : 2) * _bufferSize;\n    _bufferSize < Infinity && adjustedBufferSize < _buffer.length && _buffer.splice(0, _buffer.length - adjustedBufferSize);\n\n    // Now, if we're not in an infinite time window, remove all values where the time is\n    // older than what is allowed.\n    if (!_infiniteTimeWindow) {\n      const now = _timestampProvider.now();\n      let last = 0;\n      // Search the array for the first timestamp that isn't expired and\n      // truncate the buffer up to that point.\n      for (let i = 1; i < _buffer.length && (_buffer[i] as number) <= now; i += 2) {\n        last = i;\n      }\n      last && _buffer.splice(0, last + 1);\n    }\n  }\n}\n","import { Operator } from './Operator';\nimport { Observable } from './Observable';\nimport { Subscriber } from './Subscriber';\nimport { Subscription, EMPTY_SUBSCRIPTION } from './Subscription';\nimport { Observer, SubscriptionLike, TeardownLogic } from './types';\nimport { ObjectUnsubscribedError } from './util/ObjectUnsubscribedError';\nimport { arrRemove } from './util/arrRemove';\nimport { errorContext } from './util/errorContext';\n\n/**\n * A Subject is a special type of Observable that allows values to be\n * multicasted to many Observers. Subjects are like EventEmitters.\n *\n * Every Subject is an Observable and an Observer. You can subscribe to a\n * Subject, and you can call next to feed values as well as error and complete.\n */\nexport class Subject<T> extends Observable<T> implements SubscriptionLike {\n  closed = false;\n\n  private currentObservers: Observer<T>[] | null = null;\n\n  /** @deprecated Internal implementation detail, do not use directly. Will be made internal in v8. */\n  observers: Observer<T>[] = [];\n  /** @deprecated Internal implementation detail, do not use directly. Will be made internal in v8. */\n  isStopped = false;\n  /** @deprecated Internal implementation detail, do not use directly. Will be made internal in v8. */\n  hasError = false;\n  /** @deprecated Internal implementation detail, do not use directly. Will be made internal in v8. */\n  thrownError: any = null;\n\n  /**\n   * Creates a \"subject\" by basically gluing an observer to an observable.\n   *\n   * @nocollapse\n   * @deprecated Recommended you do not use. Will be removed at some point in the future. Plans for replacement still under discussion.\n   */\n  static create: (...args: any[]) => any = <T>(destination: Observer<T>, source: Observable<T>): AnonymousSubject<T> => {\n    return new AnonymousSubject<T>(destination, source);\n  };\n\n  constructor() {\n    // NOTE: This must be here to obscure Observable's constructor.\n    super();\n  }\n\n  /** @deprecated Internal implementation detail, do not use directly. Will be made internal in v8. */\n  lift<R>(operator: Operator<T, R>): Observable<R> {\n    const subject = new AnonymousSubject(this, this);\n    subject.operator = operator as any;\n    return subject as any;\n  }\n\n  /** @internal */\n  protected _throwIfClosed() {\n    if (this.closed) {\n      throw new ObjectUnsubscribedError();\n    }\n  }\n\n  next(value: T) {\n    errorContext(() => {\n      this._throwIfClosed();\n      if (!this.isStopped) {\n        if (!this.currentObservers) {\n          this.currentObservers = Array.from(this.observers);\n        }\n        for (const observer of this.currentObservers) {\n          observer.next(value);\n        }\n      }\n    });\n  }\n\n  error(err: any) {\n    errorContext(() => {\n      this._throwIfClosed();\n      if (!this.isStopped) {\n        this.hasError = this.isStopped = true;\n        this.thrownError = err;\n        const { observers } = this;\n        while (observers.length) {\n          observers.shift()!.error(err);\n        }\n      }\n    });\n  }\n\n  complete() {\n    errorContext(() => {\n      this._throwIfClosed();\n      if (!this.isStopped) {\n        this.isStopped = true;\n        const { observers } = this;\n        while (observers.length) {\n          observers.shift()!.complete();\n        }\n      }\n    });\n  }\n\n  unsubscribe() {\n    this.isStopped = this.closed = true;\n    this.observers = this.currentObservers = null!;\n  }\n\n  get observed() {\n    return this.observers?.length > 0;\n  }\n\n  /** @internal */\n  protected _trySubscribe(subscriber: Subscriber<T>): TeardownLogic {\n    this._throwIfClosed();\n    return super._trySubscribe(subscriber);\n  }\n\n  /** @internal */\n  protected _subscribe(subscriber: Subscriber<T>): Subscription {\n    this._throwIfClosed();\n    this._checkFinalizedStatuses(subscriber);\n    return this._innerSubscribe(subscriber);\n  }\n\n  /** @internal */\n  protected _innerSubscribe(subscriber: Subscriber<any>) {\n    const { hasError, isStopped, observers } = this;\n    if (hasError || isStopped) {\n      return EMPTY_SUBSCRIPTION;\n    }\n    this.currentObservers = null;\n    observers.push(subscriber);\n    return new Subscription(() => {\n      this.currentObservers = null;\n      arrRemove(observers, subscriber);\n    });\n  }\n\n  /** @internal */\n  protected _checkFinalizedStatuses(subscriber: Subscriber<any>) {\n    const { hasError, thrownError, isStopped } = this;\n    if (hasError) {\n      subscriber.error(thrownError);\n    } else if (isStopped) {\n      subscriber.complete();\n    }\n  }\n\n  /**\n   * Creates a new Observable with this Subject as the source. You can do this\n   * to create custom Observer-side logic of the Subject and conceal it from\n   * code that uses the Observable.\n   * @return {Observable} Observable that the Subject casts to\n   */\n  asObservable(): Observable<T> {\n    const observable: any = new Observable<T>();\n    observable.source = this;\n    return observable;\n  }\n}\n\n/**\n * @class AnonymousSubject<T>\n */\nexport class AnonymousSubject<T> extends Subject<T> {\n  constructor(\n    /** @deprecated Internal implementation detail, do not use directly. Will be made internal in v8. */\n    public destination?: Observer<T>,\n    source?: Observable<T>\n  ) {\n    super();\n    this.source = source;\n  }\n\n  next(value: T) {\n    this.destination?.next?.(value);\n  }\n\n  error(err: any) {\n    this.destination?.error?.(err);\n  }\n\n  complete() {\n    this.destination?.complete?.();\n  }\n\n  /** @internal */\n  protected _subscribe(subscriber: Subscriber<T>): Subscription {\n    return this.source?.subscribe(subscriber) ?? EMPTY_SUBSCRIPTION;\n  }\n}\n","import { Observable } from './Observable';\nimport { EmptyError } from './util/EmptyError';\nimport { SafeSubscriber } from './Subscriber';\n\nexport interface FirstValueFromConfig<T> {\n  defaultValue: T;\n}\n\nexport function firstValueFrom<T, D>(source: Observable<T>, config: FirstValueFromConfig<D>): Promise<T | D>;\nexport function firstValueFrom<T>(source: Observable<T>): Promise<T>;\n\n/**\n * Converts an observable to a promise by subscribing to the observable,\n * and returning a promise that will resolve as soon as the first value\n * arrives from the observable. The subscription will then be closed.\n *\n * If the observable stream completes before any values were emitted, the\n * returned promise will reject with {@link EmptyError} or will resolve\n * with the default value if a default was specified.\n *\n * If the observable stream emits an error, the returned promise will reject\n * with that error.\n *\n * **WARNING**: Only use this with observables you *know* will emit at least one value,\n * *OR* complete. If the source observable does not emit one value or complete, you will\n * end up with a promise that is hung up, and potentially all of the state of an\n * async function hanging out in memory. To avoid this situation, look into adding\n * something like {@link timeout}, {@link take}, {@link takeWhile}, or {@link takeUntil}\n * amongst others.\n *\n * ## Example\n *\n * Wait for the first value from a stream and emit it from a promise in\n * an async function\n *\n * ```ts\n * import { interval, firstValueFrom } from 'rxjs';\n *\n * async function execute() {\n *   const source$ = interval(2000);\n *   const firstNumber = await firstValueFrom(source$);\n *   console.log(`The first number is ${ firstNumber }`);\n * }\n *\n * execute();\n *\n * // Expected output:\n * // 'The first number is 0'\n * ```\n *\n * @see {@link lastValueFrom}\n *\n * @param source the observable to convert to a promise\n * @param config a configuration object to define the `defaultValue` to use if the source completes without emitting a value\n */\nexport function firstValueFrom<T, D>(source: Observable<T>, config?: FirstValueFromConfig<D>): Promise<T | D> {\n  const hasConfig = typeof config === 'object';\n  return new Promise<T | D>((resolve, reject) => {\n    const subscriber = new SafeSubscriber<T>({\n      next: (value) => {\n        resolve(value);\n        subscriber.unsubscribe();\n      },\n      error: reject,\n      complete: () => {\n        if (hasConfig) {\n          resolve(config!.defaultValue);\n        } else {\n          reject(new EmptyError());\n        }\n      },\n    });\n    source.subscribe(subscriber);\n  });\n}\n","import { Observable } from '../Observable';\nimport { SchedulerLike } from '../types';\n\n/**\n * A simple Observable that emits no items to the Observer and immediately\n * emits a complete notification.\n *\n * <span class=\"informal\">Just emits 'complete', and nothing else.</span>\n *\n * ![](empty.png)\n *\n * A simple Observable that only emits the complete notification. It can be used\n * for composing with other Observables, such as in a {@link mergeMap}.\n *\n * ## Examples\n *\n * Log complete notification\n *\n * ```ts\n * import { EMPTY } from 'rxjs';\n *\n * EMPTY.subscribe({\n *   next: () => console.log('Next'),\n *   complete: () => console.log('Complete!')\n * });\n *\n * // Outputs\n * // Complete!\n * ```\n *\n * Emit the number 7, then complete\n *\n * ```ts\n * import { EMPTY, startWith } from 'rxjs';\n *\n * const result = EMPTY.pipe(startWith(7));\n * result.subscribe(x => console.log(x));\n *\n * // Outputs\n * // 7\n * ```\n *\n * Map and flatten only odd numbers to the sequence `'a'`, `'b'`, `'c'`\n *\n * ```ts\n * import { interval, mergeMap, of, EMPTY } from 'rxjs';\n *\n * const interval$ = interval(1000);\n * const result = interval$.pipe(\n *   mergeMap(x => x % 2 === 1 ? of('a', 'b', 'c') : EMPTY),\n * );\n * result.subscribe(x => console.log(x));\n *\n * // Results in the following to the console:\n * // x is equal to the count on the interval, e.g. (0, 1, 2, 3, ...)\n * // x will occur every 1000ms\n * // if x % 2 is equal to 1, print a, b, c (each on its own)\n * // if x % 2 is not equal to 1, nothing will be output\n * ```\n *\n * @see {@link Observable}\n * @see {@link NEVER}\n * @see {@link of}\n * @see {@link throwError}\n */\nexport const EMPTY = new Observable<never>((subscriber) => subscriber.complete());\n\n/**\n * @param scheduler A {@link SchedulerLike} to use for scheduling\n * the emission of the complete notification.\n * @deprecated Replaced with the {@link EMPTY} constant or {@link scheduled} (e.g. `scheduled([], scheduler)`). Will be removed in v8.\n */\nexport function empty(scheduler?: SchedulerLike) {\n  return scheduler ? emptyScheduled(scheduler) : EMPTY;\n}\n\nfunction emptyScheduled(scheduler: SchedulerLike) {\n  return new Observable<never>((subscriber) => scheduler.schedule(() => subscriber.complete()));\n}\n","import { SchedulerLike, ValueFromArray } from '../types';\nimport { Observable } from '../Observable';\nimport { popScheduler } from '../util/args';\nimport { from } from './from';\n\n// Devs are more likely to pass null or undefined than they are a scheduler\n// without accompanying values. To make things easier for (naughty) devs who\n// use the `strictNullChecks: false` TypeScript compiler option, these\n// overloads with explicit null and undefined values are included.\n\nexport function of(value: null): Observable<null>;\nexport function of(value: undefined): Observable<undefined>;\n\n/** @deprecated The `scheduler` parameter will be removed in v8. Use `scheduled`. Details: https://rxjs.dev/deprecations/scheduler-argument */\nexport function of(scheduler: SchedulerLike): Observable<never>;\n/** @deprecated The `scheduler` parameter will be removed in v8. Use `scheduled`. Details: https://rxjs.dev/deprecations/scheduler-argument */\nexport function of<A extends readonly unknown[]>(...valuesAndScheduler: [...A, SchedulerLike]): Observable<ValueFromArray<A>>;\n\nexport function of(): Observable<never>;\n/** @deprecated Do not specify explicit type parameters. Signatures with type parameters that cannot be inferred will be removed in v8. */\nexport function of<T>(): Observable<T>;\nexport function of<T>(value: T): Observable<T>;\nexport function of<A extends readonly unknown[]>(...values: A): Observable<ValueFromArray<A>>;\n\n/**\n * Converts the arguments to an observable sequence.\n *\n * <span class=\"informal\">Each argument becomes a `next` notification.</span>\n *\n * ![](of.png)\n *\n * Unlike {@link from}, it does not do any flattening and emits each argument in whole\n * as a separate `next` notification.\n *\n * ## Examples\n *\n * Emit the values `10, 20, 30`\n *\n * ```ts\n * import { of } from 'rxjs';\n *\n * of(10, 20, 30)\n *   .subscribe({\n *     next: value => console.log('next:', value),\n *     error: err => console.log('error:', err),\n *     complete: () => console.log('the end'),\n *   });\n *\n * // Outputs\n * // next: 10\n * // next: 20\n * // next: 30\n * // the end\n * ```\n *\n * Emit the array `[1, 2, 3]`\n *\n * ```ts\n * import { of } from 'rxjs';\n *\n * of([1, 2, 3])\n *   .subscribe({\n *     next: value => console.log('next:', value),\n *     error: err => console.log('error:', err),\n *     complete: () => console.log('the end'),\n *   });\n *\n * // Outputs\n * // next: [1, 2, 3]\n * // the end\n * ```\n *\n * @see {@link from}\n * @see {@link range}\n *\n * @param {...T} values A comma separated list of arguments you want to be emitted\n * @return {Observable} An Observable that emits the arguments\n * described above and then completes.\n */\nexport function of<T>(...args: Array<T | SchedulerLike>): Observable<T> {\n  const scheduler = popScheduler(args);\n  return from(args as T[], scheduler);\n}\n","import { Observable } from '../Observable';\n\nimport { ObservableInput, OperatorFunction, ObservedValueOf } from '../types';\nimport { Subscription } from '../Subscription';\nimport { innerFrom } from '../observable/innerFrom';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\nimport { operate } from '../util/lift';\n\n/* tslint:disable:max-line-length */\nexport function catchError<T, O extends ObservableInput<any>>(\n  selector: (err: any, caught: Observable<T>) => O\n): OperatorFunction<T, T | ObservedValueOf<O>>;\n/* tslint:enable:max-line-length */\n\n/**\n * Catches errors on the observable to be handled by returning a new observable or throwing an error.\n *\n * <span class=\"informal\">\n * It only listens to the error channel and ignores notifications.\n * Handles errors from the source observable, and maps them to a new observable.\n * The error may also be rethrown, or a new error can be thrown to emit an error from the result.\n * </span>\n *\n * ![](catch.png)\n *\n * This operator handles errors, but forwards along all other events to the resulting observable.\n * If the source observable terminates with an error, it will map that error to a new observable,\n * subscribe to it, and forward all of its events to the resulting observable.\n *\n * ## Examples\n *\n * Continue with a different Observable when there's an error\n *\n * ```ts\n * import { of, map, catchError } from 'rxjs';\n *\n * of(1, 2, 3, 4, 5)\n *   .pipe(\n *     map(n => {\n *       if (n === 4) {\n *         throw 'four!';\n *       }\n *       return n;\n *     }),\n *     catchError(err => of('I', 'II', 'III', 'IV', 'V'))\n *   )\n *   .subscribe(x => console.log(x));\n *   // 1, 2, 3, I, II, III, IV, V\n * ```\n *\n * Retry the caught source Observable again in case of error, similar to `retry()` operator\n *\n * ```ts\n * import { of, map, catchError, take } from 'rxjs';\n *\n * of(1, 2, 3, 4, 5)\n *   .pipe(\n *     map(n => {\n *       if (n === 4) {\n *         throw 'four!';\n *       }\n *       return n;\n *     }),\n *     catchError((err, caught) => caught),\n *     take(30)\n *   )\n *   .subscribe(x => console.log(x));\n *   // 1, 2, 3, 1, 2, 3, ...\n * ```\n *\n * Throw a new error when the source Observable throws an error\n *\n * ```ts\n * import { of, map, catchError } from 'rxjs';\n *\n * of(1, 2, 3, 4, 5)\n *   .pipe(\n *     map(n => {\n *       if (n === 4) {\n *         throw 'four!';\n *       }\n *       return n;\n *     }),\n *     catchError(err => {\n *       throw 'error in source. Details: ' + err;\n *     })\n *   )\n *   .subscribe({\n *     next: x => console.log(x),\n *     error: err => console.log(err)\n *   });\n *   // 1, 2, 3, error in source. Details: four!\n * ```\n *\n * @see {@link onErrorResumeNext}\n * @see {@link repeat}\n * @see {@link repeatWhen}\n * @see {@link retry }\n * @see {@link retryWhen}\n *\n * @param {function} selector a function that takes as arguments `err`, which is the error, and `caught`, which\n * is the source observable, in case you'd like to \"retry\" that observable by returning it again. Whatever observable\n * is returned by the `selector` will be used to continue the observable chain.\n * @return A function that returns an Observable that originates from either\n * the source or the Observable returned by the `selector` function.\n */\nexport function catchError<T, O extends ObservableInput<any>>(\n  selector: (err: any, caught: Observable<T>) => O\n): OperatorFunction<T, T | ObservedValueOf<O>> {\n  return operate((source, subscriber) => {\n    let innerSub: Subscription | null = null;\n    let syncUnsub = false;\n    let handledResult: Observable<ObservedValueOf<O>>;\n\n    innerSub = source.subscribe(\n      createOperatorSubscriber(subscriber, undefined, undefined, (err) => {\n        handledResult = innerFrom(selector(err, catchError(selector)(source)));\n        if (innerSub) {\n          innerSub.unsubscribe();\n          innerSub = null;\n          handledResult.subscribe(subscriber);\n        } else {\n          // We don't have an innerSub yet, that means the error was synchronous\n          // because the subscribe call hasn't returned yet.\n          syncUnsub = true;\n        }\n      })\n    );\n\n    if (syncUnsub) {\n      // We have a synchronous error, we need to make sure to\n      // finalize right away. This ensures that callbacks in the `finalize` operator are called\n      // at the right time, and that finalization occurs at the expected\n      // time between the source error and the subscription to the\n      // next observable.\n      innerSub.unsubscribe();\n      innerSub = null;\n      handledResult!.subscribe(subscriber);\n    }\n  });\n}\n","import { EMPTY } from '../observable/empty';\nimport { MonoTypeOperatorFunction } from '../types';\nimport { operate } from '../util/lift';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\n\n/**\n * Waits for the source to complete, then emits the last N values from the source,\n * as specified by the `count` argument.\n *\n * ![](takeLast.png)\n *\n * `takeLast` results in an observable that will hold values up to `count` values in memory,\n * until the source completes. It then pushes all values in memory to the consumer, in the\n * order they were received from the source, then notifies the consumer that it is\n * complete.\n *\n * If for some reason the source completes before the `count` supplied to `takeLast` is reached,\n * all values received until that point are emitted, and then completion is notified.\n *\n * **Warning**: Using `takeLast` with an observable that never completes will result\n * in an observable that never emits a value.\n *\n * ## Example\n *\n * Take the last 3 values of an Observable with many values\n *\n * ```ts\n * import { range, takeLast } from 'rxjs';\n *\n * const many = range(1, 100);\n * const lastThree = many.pipe(takeLast(3));\n * lastThree.subscribe(x => console.log(x));\n * ```\n *\n * @see {@link take}\n * @see {@link takeUntil}\n * @see {@link takeWhile}\n * @see {@link skip}\n *\n * @param count The maximum number of values to emit from the end of\n * the sequence of values emitted by the source Observable.\n * @return A function that returns an Observable that emits at most the last\n * `count` values emitted by the source Observable.\n */\nexport function takeLast<T>(count: number): MonoTypeOperatorFunction<T> {\n  return count <= 0\n    ? () => EMPTY\n    : operate((source, subscriber) => {\n        // This buffer will hold the values we are going to emit\n        // when the source completes. Since we only want to take the\n        // last N values, we can't emit until we're sure we're not getting\n        // any more values.\n        let buffer: T[] = [];\n        source.subscribe(\n          createOperatorSubscriber(\n            subscriber,\n            (value) => {\n              // Add the most recent value onto the end of our buffer.\n              buffer.push(value);\n              // If our buffer is now larger than the number of values we\n              // want to take, we remove the oldest value from the buffer.\n              count < buffer.length && buffer.shift();\n            },\n            () => {\n              // The source completed, we now know what are last values\n              // are, emit them in the order they were received.\n              for (const value of buffer) {\n                subscriber.next(value);\n              }\n              subscriber.complete();\n            },\n            // Errors are passed through to the consumer\n            undefined,\n            () => {\n              // During finalization release the values in our buffer.\n              buffer = null!;\n            }\n          )\n        );\n      });\n}\n","import { TimestampProvider } from '../types';\n\ninterface DateTimestampProvider extends TimestampProvider {\n  delegate: TimestampProvider | undefined;\n}\n\nexport const dateTimestampProvider: DateTimestampProvider = {\n  now() {\n    // Use the variable rather than `this` so that the function can be called\n    // without being bound to the provider.\n    return (dateTimestampProvider.delegate || Date).now();\n  },\n  delegate: undefined,\n};\n","import { createErrorClass } from './createErrorClass';\n\nexport interface EmptyError extends Error {}\n\nexport interface EmptyErrorCtor {\n  /**\n   * @deprecated Internal implementation detail. Do not construct error instances.\n   * Cannot be tagged as internal: https://github.com/ReactiveX/rxjs/issues/6269\n   */\n  new (): EmptyError;\n}\n\n/**\n * An error thrown when an Observable or a sequence was queried but has no\n * elements.\n *\n * @see {@link first}\n * @see {@link last}\n * @see {@link single}\n * @see {@link firstValueFrom}\n * @see {@link lastValueFrom}\n *\n * @class EmptyError\n */\nexport const EmptyError: EmptyErrorCtor = createErrorClass((_super) => function EmptyErrorImpl(this: any) {\n  _super(this);\n  this.name = 'EmptyError';\n  this.message = 'no elements in sequence';\n});\n","import { createErrorClass } from './createErrorClass';\n\nexport interface ObjectUnsubscribedError extends Error {}\n\nexport interface ObjectUnsubscribedErrorCtor {\n  /**\n   * @deprecated Internal implementation detail. Do not construct error instances.\n   * Cannot be tagged as internal: https://github.com/ReactiveX/rxjs/issues/6269\n   */\n  new (): ObjectUnsubscribedError;\n}\n\n/**\n * An error thrown when an action is invalid because the object has been\n * unsubscribed.\n *\n * @see {@link Subject}\n * @see {@link BehaviorSubject}\n *\n * @class ObjectUnsubscribedError\n */\nexport const ObjectUnsubscribedError: ObjectUnsubscribedErrorCtor = createErrorClass(\n  (_super) =>\n    function ObjectUnsubscribedErrorImpl(this: any) {\n      _super(this);\n      this.name = 'ObjectUnsubscribedError';\n      this.message = 'object unsubscribed';\n    }\n);\n","import { SchedulerLike } from '../types';\nimport { isFunction } from './isFunction';\nimport { isScheduler } from './isScheduler';\n\nfunction last<T>(arr: T[]): T | undefined {\n  return arr[arr.length - 1];\n}\n\nexport function popResultSelector(args: any[]): ((...args: unknown[]) => unknown) | undefined {\n  return isFunction(last(args)) ? args.pop() : undefined;\n}\n\nexport function popScheduler(args: any[]): SchedulerLike | undefined {\n  return isScheduler(last(args)) ? args.pop() : undefined;\n}\n\nexport function popNumber(args: any[], defaultValue: number): number {\n  return typeof last(args) === 'number' ? args.pop()! : defaultValue;\n}\n","import {DynamicComponent} from \"./dynamic-component\";\nimport {FormControl, FormGroup} from \"@angular/forms\";\nimport {PossibleTemplateList, TemplateList} from \"./template-list\";\nimport {DynamicEventSource, DynamicEventType} from \"./dynamic-event\";\nimport {Subscription} from \"rxjs\";\nimport {Component, OnDestroy} from \"@angular/core\";\n\n/**\n * A component that can be dynamically loaded by the dont-code framework.\n * It can integrate with a reactive form.\n * To dynamically load other Dont-code components for subFields, you should use AbstractDynamicLoaderComponent instead\n * To listen to model change, you have to derive from PluginBaseComponent instead.\n */\n@Component({template:''})\nexport abstract class AbstractDynamicComponent implements DynamicComponent, OnDestroy{\n\n  name!: string;\n  value: any;\n  form!: FormGroup;\n\n  parentPosition:string|null=null;\n\n  subscriptions = new Subscription();\n\n  setName(name: string): void {\n    this.name = name;\n  }\n\n  getValue(): any {\n    if (this.form!=null)\n      this.updateValueFromForm();\n    return this.value;\n  }\n\n  setValue(val: any): void {\n    this.value=val;\n\n    if (this.form!=null)\n      this.hydrateValueToForm ();\n  }\n\n  setParentPosition(position: string) {\n    this.parentPosition=position;\n  }\n\n  abstract providesTemplates(key?: string): TemplateList;\n  abstract canProvide(key?: string): PossibleTemplateList;\n\n  setForm(form: FormGroup): void {\n    this.form=form;\n    if ((this.form!=null) && (this.name!=null)) {\n      this.createAndRegisterFormControls();\n    }\n  }\n\n  getForm (): FormGroup {\n    return this.form;\n  }\n\n  /**\n   * By default registers a single control with the name this.name\n   * @protected\n   */\n  protected createAndRegisterFormControls (): void {\n    const control = new FormControl (null, {updateOn:'blur'});\n    this.form.registerControl(this.name, control);\n  }\n  /**\n   * This method allows components to generate a value manageable in FormControl from the original value (set by setValue ())\n   * By default the same value is used\n   * @param val\n   */\n  transformToFormGroupValue(val: any): any {\n    return val;\n  }\n\n  /**\n   * From the values in FormControl to a value manageable by the Dont-code Framework. Will be called by getValue\n   * By default the same value is used\n   * @param val\n   */\n  transformFromFormGroupValue(val: any): any {\n    return val;\n  }\n\n  /**\n   * Updates the form with the value\n   */\n  hydrateValueToForm ():void {\n    if (this.name!=null) {\n      const control = this.form.get(this.name);\n      if( control==null) {\n        throw new Error(\"No form control for the name \"+this.name);\n      } else {\n        const formValue = this.transformToFormGroupValue(this.value);\n        control.setValue(formValue, { emitEvent: false });\n      }\n    }\n  }\n\n  /**\n   * Retrieve value from the Angular form, and converts it to a value that can be stored\n   * @return true if value have been updated\n   */\n  updateValueFromForm ():boolean {\n    if (this.name==null)\n      return false;\n    const control = this.form.get(this.name);\n    if( control==null) {\n      throw new Error(\"No form control for the name \"+this.name);\n    } else {\n      if (control.dirty) {\n        this.value= this.transformFromFormGroupValue(control.value);\n        control.markAsPristine({onlySelf: true});\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Returns a string that can best display the value or null if it's already a string\n   * @param value\n   */\n  public static toBeautifyString (value:unknown, maxLength?:number): string|null {\n    if( value == null)\n      return null;\n\n    let ret=\"\";\n\n    if ( Array.isArray(value)) {\n      value = value[0];\n    }\n    // Try to see if we have json or Date or something else\n    switch (typeof value) {\n      case \"string\": {\n        ret = value;\n        break;\n      }\n      case \"object\": {\n        if (value instanceof Date) {\n          ret = value.toLocaleDateString();\n        } else {\n          ret = JSON.stringify(value, null, 2);\n        }\n        break;\n      }\n      case \"undefined\": {\n        break;\n      }\n      default: {\n        ret = (value as any).toLocaleString();\n      }\n    }\n\n    if( maxLength!=null) {\n      if (ret.length> maxLength) {\n        ret = ret.substring(0,maxLength-3)+'...';\n      }\n    }\n\n    return ret;\n  }\n\n  listEventSources(): DynamicEventSource[] {\n    return [];\n  }\n\n  selectEventSourceFor(type: DynamicEventType, name?: string): DynamicEventSource | null {\n    const sources=this.listEventSources();\n    for (const src of sources) {\n      if( src.type===type) {\n        if (name==null)\n          return src;\n        else if (src.name==name) {\n          return src;\n        }\n      }\n    }\n    return null;\n  }\n\n  ngOnDestroy(): void {\n    this.subscriptions.unsubscribe();\n  }\n\n}\n","<ng-template #inlineView>{{this.value}}</ng-template>\n<ng-template #fullEditView>\n  <ng-container *ngIf=\"form\" [formGroup]=\"form!\">\n    <p-dropdown [options]=\"options\" [formControlName]=\"name\" [filter]=\"true\" [showClear]=\"true\" placeholder=\"Select a reference\" (onChange)=\"valueChanged ($event)\" [lazy]=\"true\">\n      <ng-template pTemplate=\"selectedItem\">\n        <div *ngIf=\"this.value\">\n          {{this.value}}\n        </div>\n      </ng-template>\n      <ng-template let-reference pTemplate=\"item\">\n        {{reference}}\n      </ng-template>\n    </p-dropdown>\n  </ng-container>\n</ng-template>\n","import {InjectionToken} from \"@angular/core\";\nimport {CommandProviderInterface, Core} from \"@dontcode/core\";\nimport { CommonLibConfig } from \"../common-config/common-lib-config\";\n\nexport let COMMAND_PROVIDER = new InjectionToken<CommandProviderInterface>('Inject the current command provider interface');\n\n/**\n * Enable the Dont-code Core interface to be injected\n */\nexport const DONT_CODE_CORE=new InjectionToken<Core>(\"Dont-code core object\");\n\n/**\n * Enable the injection of static config parameters (internal use only)\n */\nexport const DONT_CODE_COMMON_CONFIG = new InjectionToken<CommonLibConfig>('DontCodeCommonLibConfig');\n","import {\n  createNgModule,\n  createNgModuleRef,\n  getNgModuleById,\n  Inject,\n  Injectable,\n  Injector,\n  NgModuleRef,\n  Optional,\n  Type,\n  ViewContainerRef,\n} from '@angular/core';\nimport {\n  ChangeHandlerConfig,\n  CommandProviderInterface,\n  Core,\n  DontCodeModelPointer,\n  DontCodePreviewManager,\n  PluginModuleInterface,\n  PreviewHandler,\n} from '@dontcode/core';\nimport {DynamicComponent} from '../common-ui/dynamic-component';\nimport {COMMAND_PROVIDER, DONT_CODE_CORE} from '../common-global/globals';\nimport {Mutex} from 'async-mutex';\n\n/**\n * Manages the dynamic loading of components able to display a data located at a specific pointer position\n * Depending on the plugins loaded, a different component can display the same value.\n *\n * It keeps in cache as well the component factory and module used for a pointer position\n */\n@Injectable({\n  providedIn: 'root',\n})\nexport class ComponentLoaderService {\n  protected moduleMap = new Map<string, NgModuleRef<PluginModuleInterface>>();\n  mutex = new Mutex();\n\n  constructor(\n    protected injector: Injector,\n    @Inject(DONT_CODE_CORE)\n    protected dontCodeCore: Core,\n    protected previewMgr: DontCodePreviewManager,\n    @Optional()\n    @Inject(COMMAND_PROVIDER)\n    protected provider?: CommandProviderInterface\n  ) {\n  }\n\n  /**\n   * Either creates or retrieves the module whose name is in parameter.\n   * @param moduleName\n   */\n  getOrCreatePluginModuleRef (moduleSource:string): Promise<NgModuleRef<PluginModuleInterface>> {\n    return this.mutex.acquire().then((release) => {\n      try {\n        let moduleRef = this.moduleMap.get(moduleSource);\n        if (!moduleRef) {\n          moduleRef = createNgModule(\n            getNgModuleById ('dontcode-plugin/' + moduleSource),\n            this.injector);\n          if (moduleRef) {\n            this.moduleMap.set(moduleSource, moduleRef);\n          }\n        }\n        return moduleRef;\n      } finally {\n        release();\n      }\n    });\n\n  }\n\n  loadPluginModule(\n    handlerConfig: ChangeHandlerConfig\n  ): Promise<NgModuleRef<PluginModuleInterface>> {\n    return this.getOrCreatePluginModuleRef(handlerConfig.class.source).then(moduleRef => {\n      if (moduleRef!=null) {\n        // Now init the newly loaded module\n        this.dontCodeCore.initPlugins();\n      }\n      return moduleRef;\n    })\n  }\n\n  insertComponentForFieldType (type: string,\n                               insertPoint: ViewContainerRef\n  ) {\n    return this.insertComponent('creation/entities/fields/type', insertPoint, type);\n  }\n\n  insertComponent(\n    schemaPosition: DontCodeModelPointer | string,\n    insertPoint: ViewContainerRef,\n    currentJson?: any\n  ): Promise<DynamicComponent | null> {\n    let schemaPos: string = (schemaPosition as DontCodeModelPointer)\n      .positionInSchema;\n    let isPointer: boolean;\n    if (schemaPos) {\n      isPointer = true;\n      if (!currentJson) {\n        currentJson = this.provider?.getJsonAt(\n          (schemaPosition as DontCodeModelPointer).position\n        );\n      }\n    } else {\n      isPointer=false;\n      schemaPos = schemaPosition as string;\n    }\n\n    const handlerConfig = this.previewMgr.retrieveHandlerConfig(\n      schemaPos,\n      currentJson\n    );\n\n    if (handlerConfig) {\n      //console.debug('Importing from ', handlerConfig.class.source);\n      // First lets try if the plugin is imported during the compilation\n\n      return this.loadPluginModule(handlerConfig)\n        .then((moduleRef) => {\n          const componentClass = moduleRef.instance\n            .exposedPreviewHandlers()\n            .get(handlerConfig.class.name);\n\n          return this.createComponent(componentClass, insertPoint, moduleRef, isPointer?schemaPosition as DontCodeModelPointer:null);\n        })\n        .catch((reason) => {\n          console.error (\"Cannot load module because of \", reason);\n          return Promise.reject(\n            'Cannot load module for source ' +\n              handlerConfig.class.source +\n              ' because of ' +\n              reason\n          );\n        });\n      //console.log (\"Applying component\");\n    } else {\n      return Promise.resolve(null);\n    }\n  }\n\n  createComponent(\n    componentClass: Type<DynamicComponent>,\n    insertPoint: ViewContainerRef,\n    moduleRef: NgModuleRef<PluginModuleInterface> | undefined,\n    position: DontCodeModelPointer | null\n  ): DynamicComponent {\n    let injector = this.injector;\n    const componentRef = insertPoint.createComponent(\n      componentClass, {\n      injector:injector,\n      ngModuleRef: moduleRef\n      }\n    );\n    const component = componentRef.instance as DynamicComponent;\n\n    if ((component as unknown as PreviewHandler).initCommandFlow) {\n      // It's a previewHandler\n      if (!position)\n        throw new Error(\n          'Component ' +\n            component.constructor.name +\n            ' is a PreviewHandler and parent position is missing.'\n        );\n      if (!this.provider)\n        throw new Error(\n          'Component ' +\n            component.constructor.name +\n            ' is a PreviewHandler and CommandProviderInterface is missing.'\n        );\n      (component as unknown as PreviewHandler).initCommandFlow(\n        this.provider,\n        position\n      );\n    }\n    return component;\n  }\n\n  /**\n   * For some reasons, during a Jest test, modules are not registered in Angular getNgModuleById(), so we let the possibility to do it by hand\n   * @param module\n   * @param source\n   */\n  registerModuleForTest (module:NgModuleRef<PluginModuleInterface>|Type<PluginModuleInterface>, source:string) {\n    if( (module as any).instance == null )  // It's not a NgModuleRef\n      this.moduleMap.set(source, createNgModule(module as Type<PluginModuleInterface>, this.injector));\n    else\n      this.moduleMap.set(source, module as NgModuleRef<PluginModuleInterface>);\n  }\n}\n","import {AbstractDynamicComponent} from './abstract-dynamic-component';\nimport {DynamicComponent} from './dynamic-component';\nimport {\n  AfterViewInit,\n  ChangeDetectorRef,\n  Component,\n  Directive,\n  Injector,\n  TemplateRef,\n  ViewChild,\n  ViewContainerRef,\n} from '@angular/core';\nimport {DontCodeModelPointer} from '@dontcode/core';\nimport {FormGroup} from '@angular/forms';\nimport {ComponentLoaderService} from '../common-dynamic/component-loader.service';\nimport {ReplaySubject} from \"rxjs\";\n\n/** A component must be attached to a insertionpoint in the template **/\n@Directive({ selector: 'dtcde-dynamic' })\nexport class DynamicInsertPoint {}\n\n/**\n * A component that can be dynamically loaded by the dont-code framework, and can dynamically load subcomponents\n * It can integrate with the reactive form or not depending on calling setForm () or not.\n *\n * Components that dynamically loads other components must at least define an insertion point by using this <dtcde-dynamic></dtcde-dynamic>\n */\n@Component({ template: '' })\nexport abstract class AbstractDynamicLoaderComponent\n  extends AbstractDynamicComponent\n  implements AfterViewInit\n{\n  @ViewChild(DynamicInsertPoint, { read: ViewContainerRef, static: false })\n  dynamicInsertPoint!: ViewContainerRef;\n\n  /**\n   * Manages the components that are bound to the form\n   */\n  protected fields = new Array<SubFieldInfo>();\n  /**\n   * Stores the position of subField in fields depending on its name\n   * @protected\n   */\n  protected fieldsMap = new Map<string, number>();\n  protected parentForm: FormGroup|null = null;\n\n  /**\n   * Any action that needs to happen after ngAfterViewInit can be added to this.\n   * @protected\n   */\n  protected componentInited = new ReplaySubject<boolean> ();\n\n  protected constructor(\n    protected loader: ComponentLoaderService,\n    protected injector: Injector,\n    protected ref: ChangeDetectorRef\n  ) {\n    super();\n  }\n\n\n  /**\n   * Define that a subvalue named propertyAndFormName will be managed by a subcomponent of type type\n   * Example: defineSubFields ('currencyCode', 'Currency') will handle a plugin to manage the currency\n   * @param formName\n   * @param type\n   */\n  defineSubField (propertyAndFormName:string, type:string) {\n    const newSubField = new SubFieldInfo(propertyAndFormName, type);\n    this.addSubField(newSubField);\n  }\n\n  /**\n   * Retrieve the information of the subfield at the given name.\n   * @param propertyAndFormName\n   * @protected\n   */\n  protected getSubField (propertyAndFormName:string): SubFieldInfo|undefined {\n    const pos = this.fieldsMap.get(propertyAndFormName);\n    if (pos!=null)\n      return this.fields[pos];\n    else\n      return;\n  }\n\n  protected addSubField (toAdd:SubFieldInfo): number {\n    const pos = this.fields.push( toAdd);\n    this.fieldsMap.set(toAdd.name, pos-1);\n    return pos;\n  }\n\n  getSubFields (): SubFieldInfo[] {\n    return this.fields;\n  }\n\n  /**\n   * This component will load subfields, so unless it doesn't have a name, it creates a new FormGroup\n   * @param form\n   */\n  override setForm(form: FormGroup): void {\n      // Register a FormGroup for this component has it will have to manage values from subFields as well\n    if (this.name) {\n      const formGroup = new FormGroup({}, { updateOn: 'blur' });\n      form.registerControl(this.name, formGroup);\n      super.setForm(formGroup);\n      this.parentForm = form;\n    } else {\n      super.setForm(form);\n      this.parentForm = null;\n    }\n    this.preloadSubFields();\n  }\n\n  override hydrateValueToForm() {\n      // Don't try to update the form as if it is a standard component\n      // as most likely we have created a new FormGroup\n    if (this.parentForm==null)\n      super.hydrateValueToForm();\n    else {\n      let formValue = this.transformToFormGroupValue(this.value);\n      // Sets the form value that are not managed directly by a field\n      for (const key in this.form.controls) {\n        if (this.fieldsMap.get(key)==null) {\n          const control = this.form.get(key);\n          control?.setValue(formValue?formValue[key]:formValue, {emitEvent: false});\n        }\n      }\n    }\n  }\n\n  override updateValueFromForm(): boolean {\n    if (this.parentForm==null)\n      return super.updateValueFromForm();\n    else {\n      let isChanged = false;\n      // Sets the form value that are not managed directly by a field\n      for (const key in this.form.controls) {\n        if (this.fieldsMap.get(key) == null) {\n          const control = this.form.get(key);\n          if( control!=null) {\n            if( control.dirty) {\n              const value = this.transformFromFormGroupValue(control?.value);\n              if (this.value==null) {\n                this.value={};\n              }\n              this.value[key]=value;\n              isChanged=true;\n              control.markAsPristine({onlySelf: true});\n            }\n          }\n        }\n      }\n      return isChanged;\n    }\n  }\n\n  override setValue(val: any) {\n    super.setValue(val);\n\n      // Split the value into its subcomponents\n    for (const element of this.fields) {\n      if (val!=null)\n        this.setSubFieldValue(element, val[element.name]);\n      else\n        this.setSubFieldValue(element, undefined);\n    }\n  }\n\n\n  override getValue(): any {\n    let val = super.getValue();\n    // Adds subfield values into the main value\n    for (const element of this.fields) {\n      const subFieldValue = this.getSubFieldValue(element);\n      if( (subFieldValue!=null) && (val==null)) {\n        this.value={};\n        val=this.value;\n      }\n      if( val[element.name]!==subFieldValue)\n        val[element.name]=subFieldValue;\n    }\n    return val;\n  }\n\n\n  /**\n   * Retrieve the fulledittemplate for a subfield\n   * * @param formName\n   */\n  subFieldFullEditTemplate (subField:string|SubFieldInfo): TemplateRef<any> | null {\n    const subInfo = (typeof subField === 'string')?this.getSubField(subField as string):subField as SubFieldInfo;\n    const component = subInfo?.component;\n    let ret= null;\n    if (component!=null) {\n      ret = component.providesTemplates(subInfo?.type).forFullEdit;\n    }\n    if( subField==null)\n      throw new Error (\"No template for subField \"+subInfo?.name+\" of component \"+this.name);\n    else\n      return ret;\n  }\n\n  /**\n   * Retrieve the fulledittemplate for a subfield\n   * * @param formName\n   */\n  subFieldInlineViewTemplate (subField:string|SubFieldInfo): TemplateRef<any> | null {\n    const subInfo = (typeof subField === 'string')?this.getSubField(subField as string):subField as SubFieldInfo;\n    const component = subInfo?.component;\n    let ret= null;\n    if (component!=null) {\n      ret = component.providesTemplates(subInfo?.type).forInlineView;\n    }\n    if( subField==null)\n      throw new Error (\"No template for subField \"+subInfo?.name+\" of component \"+this.name);\n    else\n      return ret;\n  }\n\n  /**\n   * Retrieve the fullviewtemplate for a subfield\n   * * @param formName\n   */\n  subFieldFullViewTemplate (subField:string|SubFieldInfo): TemplateRef<any> | null {\n    const subInfo = (typeof subField === 'string')?this.getSubField(subField as string):subField as SubFieldInfo;\n    const component = subInfo?.component;\n    let ret= null;\n    if (component!=null) {\n      ret = component.providesTemplates(subInfo?.type).forFullView;\n    }\n    if( subField==null)\n      throw new Error (\"No template for subField \"+subInfo?.name+\" of component \"+this.name);\n    else\n      return ret;\n  }\n\n  /**\n   * Dynamically loads the component to handle the subfield\n   * @param formName\n   * @param type\n   * @param subValue\n   */\n  loadSubField(\n    subField: string | SubFieldInfo,\n    type: string,\n    subValue: any\n  ): Promise<DynamicComponent | null> {\n    const subInfo = (typeof subField === 'string')?this.getSubField(subField as string):subField as SubFieldInfo;\n    const component = subInfo?.component;\n    if (component == null) {\n      return this.loader\n        .insertComponentForFieldType(type, this.dynamicInsertPoint)\n        .then((component) => {\n          if (component!=null) {\n            this.prepareComponent(component, type,(subInfo!=null)?subInfo.name:null, subValue);\n            return component;\n          } else {\n            return null;\n          }\n        });\n    } else {\n      return Promise.resolve(component);\n    }\n  }\n\n  /**\n   * Retrieve the subField value from the component handling it\n   * @param formName\n   * @param type\n   */\n  getSubFieldValue(subField: string | SubFieldInfo): any {\n    const subInfo = (typeof subField === 'string')?this.getSubField(subField as string):subField as SubFieldInfo;\n    const component = subInfo?.component;\n    if (component!=null) {\n      return component.getValue();\n    } else {\n      // No component is handling this subField so we have to do it ourselves\n      if ((this.form!=null)&&(subInfo!=null)) {\n        return this.form.get(subInfo.name)?.value;\n      } else {\n        throw new Error(\n          'Cannot provide value for non existent subField ' + subField\n        );\n      }\n    }\n  }\n\n  /**\n   * Programmatically sets the value of the component handling the subfield\n   * @param formName\n   * @param type\n   * @param val\n   */\n  setSubFieldValue(subField: string|SubFieldInfo, val: any) {\n    const subInfo = (typeof subField === 'string')?this.getSubField(subField as string):subField as SubFieldInfo;\n    const component = subInfo?.component;\n    // Sometimes no subcomponent is loaded, for example when displaying value only\n    if (component!=null) {\n        component.setValue(val);\n    }  else {\n      // No components will manage the value, so let's transform it to a displayable string\n      if ((this.form!=null) && (subInfo!=null)) {\n        const singleVal: { [key: string]: any } = {};\n        let updatedValue = AbstractDynamicLoaderComponent.toBeautifyString(val);\n        if (updatedValue == undefined)  // You cannot set a value to undefined\n          updatedValue = null;\n        singleVal[subInfo.name] = updatedValue;\n        this.form.patchValue(singleVal, {emitEvent: false});\n      }\n    }\n  }\n\n  /**\n   * Loads the component that will handle the display and edit for the item at the specified position\n   * @param position: Either the schemaPosition as string or as DontCodeModelPointer\n   * @param currentJson\n   */\n  loadSubComponent(\n    position: DontCodeModelPointer,\n    type:string,\n    formName:string|null,\n    currentJson?: any\n  ): Promise<DynamicComponent | null> {\n      // Make sure you wait until the component itself is init (and the dynamicInsertPoint is valid)\n\n    return new Promise<void>((resolve, reject) => this.componentInited.subscribe({\n        complete: () => {\n          resolve();\n        },\n        error: (err) => {\n          reject(err);\n        }\n      })).then( () => {\n        //console.debug(\"LoadSubComponent:\"+position.position+' with type '+type+', dynamicInsertPoint is ', (this.dynamicInsertPoint!=null));\n        if (this.dynamicInsertPoint==null) {\n          return null;\n        }\n        return this.loader\n          .insertComponent(position, this.dynamicInsertPoint, currentJson)\n          .then((component) => {\n            if (component != null) {\n              return this.prepareComponent(component, type, formName, currentJson);\n            } else {\n              //console.warn('No ComponentFactory or missing <dtcde-dynamic></dtcde-dynamic> in template');\n              return null;\n            }\n          });\n      });\n  }\n\n  prepareComponent(\n    component: DynamicComponent,\n    type:string,\n    formName: string | null,\n    subValue: any\n  ): DynamicComponent {\n    // Manages dynamic forms if needed\n    if (formName) {\n      /*if (!this.form)\n        throw new Error(\n          'Cannot prepare a subField component without a FormGroup'\n        );*/\n      // Tells the component he's part of a form\n      if (this.form!=null) {\n        component.setName(formName);\n        component.setForm(this.form);\n      }\n      component.setValue(subValue);\n\n    }\n    return component;\n  }\n\n  applyComponentToSubField (component: DynamicComponent, type:string, formName:string): boolean {\n    let info =this.getSubField(formName);\n    if( info==null) {\n      info = new SubFieldInfo(formName, type, component);\n      this.addSubField (info);\n      return true;\n    }else {\n      info.component=component;\n      return false;\n    }\n  }\n\n  ngAfterViewInit(): void {\n//    console.debug (\"DynamicInsertPoint for \"+this.constructor.name, this.dynamicInsertPoint);\n    this.componentInited.complete();\n    this.preloadSubFields();\n  }\n\n  private preloadSubFields(): void {\n    if (this.dynamicInsertPoint!=null) {\n      let detectCheckDone=false;\n      for (const element of this.fields) {\n        if( element.component==null) {\n          const valueSafe =this.value?this.value[element.name]:undefined;\n          this.loadSubField(\n            element.name,\n            element.type,\n            valueSafe\n          ).then((component) => {\n            if (component!=null) {\n              this.applyComponentToSubField(component, element.type, element.name);\n            }\n            if( (this.value!=null)&&(!detectCheckDone))\n              {\n                this.ref.detectChanges();\n                detectCheckDone=true;\n              }\n          });\n        }\n      }\n    }\n  }\n\n}\n\n/**\n * Store information to configure a subfield\n */\nexport class SubFieldInfo {\n  name: string;\n  type: string;\n  component: DynamicComponent | undefined;\n\n  constructor(name:string, type:string, comp?:DynamicComponent) {\n    this.name = name;\n    this.type = type;\n    this.component = comp;\n  }\n\n}\n","import {\n  Action,\n  ActionHandler,\n  Change,\n  ChangeType,\n  CommandProviderInterface,\n  DontCodeModelPointer,\n  PreviewHandler,\n} from '@dontcode/core';\nimport {catchError, first, flatMap, last, map, takeLast} from 'rxjs/operators';\nimport {firstValueFrom, from, Observable, of, Subscription} from 'rxjs';\nimport { Mutex } from 'async-mutex';\n\n/**\n * This class does all the hard work of managing changes and actions, so that your plugin only has to implement handleChange and performAction\n * As there is no one to one mapping between the position of the change and the position the plugin is interested in, we need to generate subevent to ensure the plugin is receiving updates.\n */\nexport class PluginHandlerHelper {\n  protected subscriptions = new Subscription();\n\n  entityPointer: DontCodeModelPointer | null = null;\n  provider: CommandProviderInterface | null = null;\n  changeHandler: PreviewHandler | null = null;\n  actionPerformer: ActionHandler | null = null;\n  mutex = new Mutex();\n\n  initCommandFlow(\n    provider: CommandProviderInterface,\n    pointer: DontCodeModelPointer,\n    changeHandler: PreviewHandler,\n    actionPerformer?: ActionHandler\n  ): any {\n    this.entityPointer = pointer;\n    this.provider = provider;\n    this.changeHandler = changeHandler;\n    if (actionPerformer!=null)\n      this.actionPerformer=actionPerformer;\n    else if ((changeHandler as any).performAction != null) {\n        // The changehandler is as well an action performer\n      this.actionPerformer= changeHandler as unknown as ActionHandler;\n    }\n  }\n\n  /**\n   * When the component is created for display, it receives the initial data as complete Json.\n   * If it wants, it can call this method who will call handleChange for each property.\n   * This will avoid to duplicate code (first when a complete json is sent, then when subelements are sent)\n   * @protected\n   */\n  decomposeJsonToMultipleChanges(\n    pointer: DontCodeModelPointer,\n    json: any\n  ): void {\n    // Do nothing as now the events are already splitted per subItems\n    if (typeof json === 'object' && this.provider) {\n      let change: Change;\n      const schemaManager = this.provider.getSchemaManager();\n      for (const prop in json) {\n        if (json.hasOwnProperty(prop)) {\n          const subPropertyPointer = schemaManager.generateSubSchemaPointer(\n            pointer,\n            prop\n          );\n          const propType = schemaManager.locateItem(\n            subPropertyPointer.positionInSchema\n          );\n          if (propType?.isArray() && subPropertyPointer.isProperty) {\n            this.decomposeJsonToMultipleChanges(subPropertyPointer, json[prop]);\n          } else {\n            change = new Change(\n              ChangeType.RESET,\n              pointer.position + '/' + prop,\n              json[prop],\n              subPropertyPointer\n            );\n            if (!propType && change.pointer) {\n              // This is not a sub property but a subItem of an array\n              //change.pointer.itemId = change.pointer.key;\n              change.pointer.isProperty = false;\n            }\n\n            if (this.changeHandler!=null) this.changeHandler.handleChange(change);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Calls handleChange each time a change event for any element below this (as per the model's position) is received\n   * @protected\n   */\n  initChangeListening(subElement?: boolean):void {\n    this.initOtherChangeListening(subElement, this.entityPointer);\n  }\n\n  /**\n   * Calls handleChange each time a change event for any element of the model given in parameter\n   * @protected\n   */\n  initOtherChangeListening(subElement?: boolean, pointer?:DontCodeModelPointer|null):void {\n    if (this.provider && pointer) {\n      let filter = pointer.position;\n      if (subElement !== true) filter += '/?';\n      this.subscriptions.add(\n        this.provider\n          .receiveCommands(filter)\n          .pipe(\n            map((change) => {\n              if ((change as any).actionType!=null) // It's an action, not a change\n              {\n                if (this.actionPerformer) {\n                  const action = change as unknown as Action;\n\n                  action.running?.next(this.actionPerformer.performAction(action));\n                }\n              }\n              else if (this.changeHandler) {\n                this.changeHandler.handleChange(change);\n              }\n            })\n          )\n          .subscribe()\n      );\n    } else {\n      throw new Error(\n        'Cannot listen to change before initCommandFlow is called'\n      );\n    }\n  }\n\n  /**\n   * Updates the array of T elements by applying the changes received and calling the transform method\n   * @param cols\n   * @param colsMap\n   * @param change\n   * @param property\n   * @param transform\n   * @private\n   */\n  applyUpdatesToArray<T>(\n    target: T[],\n    targetMap: Map<string, number>,\n    change: Change,\n    property: string,\n    transform: (position: DontCodeModelPointer, item: any) => T,\n    applyProperty?: (target: T, key: string, value: any) => boolean\n  ): Promise<T[]> {\n    return this.applyUpdatesToArrayAsync(\n      target,\n      targetMap,\n      change,\n      property,\n      (key, item) => {\n        return Promise.resolve(transform(key, item));\n      }\n    );\n  }\n\n  /**\n   * Updates the array of T elements by applying the changes received and calling the transform method\n   * @param target\n   * @param targetMap\n   * @param change\n   * @param property\n   * @param transform\n   * @param parentPosition\n   * @param applyProperty\n   * @private\n   */\n  applyUpdatesToArrayAsync<T>(\n    target: T[],\n    targetMap: Map<string, number>,\n    change: Change,\n    property: string | null,\n    transform: (position: DontCodeModelPointer, item: any) => Promise<T>,\n    parentPosition?: string,\n    applyProperty?: (target: T, key: string | null, value: any) => boolean\n  ): Promise<T[]> {\n    // We have the mutex to avoid multiple changes checking the map and target array at the same time...\n    return this.mutex.runExclusive(()=> {\n      try {\n        if (!this.provider)\n          throw new Error(\n            'Cannot apply updates before initCommandFlow is called'\n          );\n        if (!change.pointer) {\n          change.pointer = this.provider.calculatePointerFor(change.position);\n        }\n        // If the change concerns the array, then calculates it's element (itemId)\n        parentPosition = parentPosition??this.entityPointer?.position;\n        if (property != null) parentPosition = parentPosition + '/' + property;\n        const subItem = change.pointer.containerPosition === parentPosition;\n        let itemId = subItem\n          ? change.pointer.lastElement\n          : DontCodeModelPointer.lastElementOf(\n              change.pointer.containerPosition\n            ) ?? null;\n\n        let propertyId = change.pointer.isProperty\n          ? change.pointer.lastElement\n          : null;\n        let futureTarget: Observable<T> | null = null;\n        let newTarget: T | null = null;\n        let pos = -1;\n        let targetPos = -1;\n\n        if (itemId != null && targetMap.has(itemId)) {\n          // Does the target item already exist ?\n          pos = targetMap.get(itemId) as number;\n          newTarget = target[pos];\n          futureTarget = of(newTarget);\n        }\n        if (change.beforeKey) {\n          targetPos = targetMap.get(change.beforeKey) as number;\n        }\n\n        switch (change.type) {\n          case ChangeType.ADD:\n          case ChangeType.UPDATE:\n          case ChangeType.RESET:\n            if (propertyId != null) {\n              // It's not a replacement of the item but a change in one of its property\n              // Can we try to update directly the sub property?\n              if (\n                !newTarget ||\n                (newTarget &&\n                  (!applyProperty ||\n                    !applyProperty(newTarget, propertyId, change.value)))\n              ) {\n                // It cannot be dynamically updated by the caller, so we do a full replacement\n                const fullValue = this.provider.getJsonAt(\n                  change.pointer.containerPosition as string\n                );\n                //if (change.value!==fullValue[propertyId]) { Don't check as the new value as already been set in the json\n                const parentPointer = this.provider.calculatePointerFor(\n                  change.pointer.containerPosition as string\n                );\n                if (parentPointer.isProperty)\n                  throw new Error(\n                    'A parent of a property ' +\n                      change.pointer.position +\n                      ' must be an array'\n                  );\n                futureTarget = from(transform(parentPointer, fullValue));\n                /*                      }else {\n                        // We set the same value, so nothing changed\n                        futureTarget = null;\n                      }*/\n              }\n            } else {\n              // The new value replace the old one\n              futureTarget = from(transform(change.pointer, change.value));\n            }\n            break;\n          case ChangeType.MOVE:\n            if (pos !== -1 && subItem && itemId) {\n              // We delete the element moved, it will be inserted at the right position later\n              if (targetPos !== -1 && targetPos > pos) targetPos--;\n              target.splice(pos, 1);\n              // Recalculate all indexes in targetMap\n              targetMap.forEach((value, key) => {\n                if (value > pos) {\n                  targetMap.set(key, value - 1);\n                }\n              });\n              targetMap.delete(itemId);\n              pos = -1;\n            }\n            break;\n          case ChangeType.DELETE:\n            if (pos !== -1 && subItem && itemId) {\n              target.splice(pos, 1);\n              // Recalculate all indexes in targetMap\n              targetMap.forEach((value, key) => {\n                if (value > pos) {\n                  targetMap.set(key, value - 1);\n                }\n              });\n              targetMap.delete(itemId);\n            }\n            futureTarget = null;\n            break;\n        }\n\n        if (futureTarget) {\n          return firstValueFrom(futureTarget\n            .pipe(\n              map((result) => {\n                if (pos !== -1) {\n                  // We just need to replace the new value at the same position\n                  target[pos] = result;\n                } else if (targetPos !== -1) {\n                  // Insert the element at the correct position\n                  target.splice(targetPos, 0, result);\n                  // Recalculate all indexes in targetMap\n                  targetMap.forEach((value, key) => {\n                    if (value >= targetPos) {\n                      targetMap.set(key, value + 1);\n                    }\n                  });\n                  if (itemId != null) targetMap.set(itemId, targetPos);\n                  else\n                    throw new Error(\n                      'Cannot set targetPos ' +\n                        targetPos +\n                        ' without knowing the itemId'\n                    );\n                } else {\n                  // Insert the element at the end\n                  target.push(result);\n                  if (itemId != null) targetMap.set(itemId, targetMap.size);\n                  else\n                    throw new Error(\n                      'Cannot set targetPos ' +\n                        targetPos +\n                        ' without knowing the itemId'\n                    );\n                }\n                return target;\n              }),\n              takeLast(1),\n              catchError((error) => {\n                return Promise.reject(error);\n              })\n            )\n          )\n        } else {\n          return Promise.resolve(target);\n        }\n      } catch (error) {\n        return Promise.reject(error);\n      }\n    });\n  }\n\n  unsubscribe() {\n    this.subscriptions.unsubscribe();\n  }\n\n  /**\n   * Sends the action to whatever component can perform it\n   * @param action\n   */\n  async performAction(action: Action): Promise<void> {\n    if( this.provider!=null)\n      await this.provider.sendCommand (action);\n    else return Promise.reject('No provider for the component at position '+this.entityPointer?.position );\n  }\n}\n","import {ChangeDetectorRef, Component, Injector, OnDestroy} from '@angular/core';\nimport {\n  Change,\n  CommandProviderInterface, DontCodeModel,\n  DontCodeModelPointer,\n  PreviewHandler,\n} from '@dontcode/core';\nimport { ComponentLoaderService } from '../common-dynamic/component-loader.service';\nimport {AbstractDynamicLoaderComponent, SubFieldInfo} from './abstract-dynamic-loader-component';\nimport { PluginHandlerHelper } from '../common-handler/plugin-handler-helper';\nimport {debounceTime, Subscription} from 'rxjs';\nimport {DynamicComponent} from \"./dynamic-component\";\nimport {FormControl, Validators} from \"@angular/forms\";\nimport {map} from \"rxjs/operators\";\n\n/**\n * A component that can be loaded by the framework, load subcomponents, listen to model changes, and so on...\n * It can as well dynamically manage a list of subcomponents and a form together with its mapping to a value.\n */\n@Component({ template: '' })\nexport abstract class PluginBaseComponent\n  extends AbstractDynamicLoaderComponent\n  implements PreviewHandler, OnDestroy\n{\n  protected pluginHelper = new PluginHandlerHelper();\n  entityPointer: DontCodeModelPointer | null = null;\n  protected provider: CommandProviderInterface | null = null;\n\n  constructor(loader: ComponentLoaderService, injector: Injector,ref: ChangeDetectorRef) {\n    super(loader, injector, ref);\n  }\n\n  override ngOnDestroy(): void {\n    this.pluginHelper.unsubscribe();\n    super.ngOnDestroy();\n  }\n\n  /**\n   * Listen to this.form updates and update this.value accordingly\n   * @protected\n   */\n  protected updateValueOnFormChanges():void {\n    this.subscriptions.add(this.form.valueChanges.pipe(\n      map (value => {\n        //console.debug(\"Value changed\", value);\n        // Force the recalculation of the data from the form\n        this.getValue();\n        return value;\n      })\n      ).subscribe()\n    );\n  }\n\n  initCommandFlow(\n    provider: CommandProviderInterface,\n    pointer: DontCodeModelPointer\n  ): any {\n    this.entityPointer = pointer;\n    this.provider = provider;\n    this.pluginHelper.initCommandFlow(provider, pointer, this);\n  }\n\n  protected initChangeListening(subElement?: boolean) {\n    this.pluginHelper.initChangeListening(subElement);\n  }\n\n  /**\n   * When the component is created for display, it receives the initial data as complete Json.\n   * If it wants, it can call this method who will call handleChange for each property.\n   * This will avoid to duplicate code (first time when a complete json is sent, second when subelements are sent)\n   * @protected\n   */\n  protected decomposeJsonToMultipleChanges(\n    pointer: DontCodeModelPointer,\n    json: any\n  ): void {\n    this.pluginHelper.decomposeJsonToMultipleChanges(pointer, json);\n  }\n\n  /**\n   * Retrieve the value of the key property if the change concerns it\n   * @param change\n   * @param key\n   */\n  decodeStringField(change: Change, key: string): string | undefined {\n    if (change.pointer?.lastElement === key) {\n      return change.value;\n    } else return undefined;\n  }\n\n  /**\n   * Updates the array of T elements by applying the changes received and calling the transform method\n   * @param target\n   * @param targetMap\n   * @param change\n   * @param property\n   * @param transform\n   * @param parentPosition\n   * @param applyProperty\n   * @private\n   */\n  applyUpdatesToArray<T>(\n    target: T[],\n    targetMap: Map<string, number>,\n    change: Change,\n    property: string,\n    transform: (position: DontCodeModelPointer, item: any) => T,\n    parentPosition?: string,\n    applyProperty?: (target: T, key: string, value: any) => boolean\n  ): Promise<T[]> {\n    return this.applyUpdatesToArrayAsync(\n      target,\n      targetMap,\n      change,\n      property,\n      (key, item) => {\n        return Promise.resolve(transform(key, item));\n      },\n      parentPosition\n    );\n  }\n\n  /**\n   * Updates the array of T elements by applying the changes received and calling the transform method\n   * @param target\n   * @param targetMap\n   * @param change\n   * @param property\n   * @param transform\n   * @param parentPosition\n   * @param applyProperty\n   * @private\n   */\n  applyUpdatesToArrayAsync<T>(\n    target: T[],\n    targetMap: Map<string, number>,\n    change: Change,\n    property: string | null,\n    transform: (position: DontCodeModelPointer, item: any) => Promise<T>,\n    parentPosition?: string,\n    applyProperty?: (target: T, key: string | null, value: any) => boolean\n  ): Promise<T[]> {\n    return this.pluginHelper.applyUpdatesToArrayAsync(\n      target,\n      targetMap,\n      change,\n      property,\n      transform,\n      parentPosition,\n      applyProperty\n    );\n  }\n\n  abstract handleChange(change: Change): void;\n\n  /**\n   * Dynamically manages the list of subFields (and sub components) based on the change.\n   * @param change\n   * @protected\n   */\n  protected updateSubFieldsWithChange(change: Change, subProperty:string|null, parentPosition?: string): Promise<SubFieldInfo[]|null> {\n      return this.applyUpdatesToArrayAsync(\n        this.fields,\n        this.fieldsMap,\n        change,\n        subProperty,\n        (position, value) => {\n          return this.loadSubComponent(position, value.type, value.name).then((component) => {\n            return new SubFieldInfo(value.name, value.type, component??undefined);\n          });\n        },\n        parentPosition,\n        (elt, key, newVal) => {\n          switch (key) {\n            case DontCodeModel.APP_FIELDS_NAME_NODE:\n              elt.name = newVal;\n              break;\n            default:\n              return false;\n          }\n          return true;\n        }\n      ).then((updatedFields) => {\n        this.fields = updatedFields;\n        this.rebuildForm();\n        return updatedFields;\n      });\n  }\n\n  /**\n   * Rebuild the Reactive form from the list of fields configured with the entity\n   * @protected\n   */\n  protected rebuildForm() {\n\n    if (this.form==null)  // Ignore if the component doesn't have a form\n      return;\n    // Updates the formgroup with new fields and remove old fields if necessary\n    const toRemove = new Set<string>();\n    // tslint:disable-next-line:forin\n    for (const formKey in this.form.controls) {\n      toRemove.add(formKey);\n    }\n\n    for (const field of this.fields) {\n      let val = null;\n      if (this.value && this.value[field.name]) {\n        val = this.value[field.name];\n      }\n      toRemove.delete(field.name);\n\n      // Check if the component manages the FormControl itself or if it relies on us\n      if (field.component!=null) {\n        field.component?.setValue(val);\n      } else {\n        val = PluginBaseComponent.toBeautifyString(val);\n        this.form.registerControl(\n          field.name,\n          new FormControl(val, Validators.required)\n        );\n      }\n    }\n\n    toRemove.forEach((key) => {\n      this.form.removeControl(key);\n    });\n  }\n\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport {PluginBaseComponent} from \"../plugin-base.component\";\n\n/**\n * Converts any object to a nice string to be displayed in html\n */\n@Pipe({\n  name: 'beautifier',\n  pure:true\n})\nexport class BeautifierPipe implements PipeTransform {\n\n  transform(value: unknown, ...args: unknown[]): unknown {\n    return PluginBaseComponent.toBeautifyString(value, args[0] as number);\n  }\n\n}\n","import {TemplateRef} from \"@angular/core\";\n\nexport class TemplateList {\n  forInlineView: TemplateRef<any>|null;\n  forFullView: TemplateRef<any>|null;\n  forFullEdit: TemplateRef<any>|null;\n\n\n  constructor(forInlineView: TemplateRef<any>|null, forFullView: TemplateRef<any>|null, forFullEdit: TemplateRef<any>|null) {\n    this.forInlineView = forInlineView;\n    this.forFullView = forFullView;\n    this.forFullEdit = forFullEdit;\n  }\n}\n\nexport class PossibleTemplateList {\n  forInlineView: boolean;\n  forFullView: boolean;\n  forFullEdit: boolean;\n\n\n  constructor(forInlineView: boolean, forFullView: boolean, forFullEdit: boolean) {\n    this.forInlineView = forInlineView;\n    this.forFullView = forFullView;\n    this.forFullEdit = forFullEdit;\n  }\n}\n","import {Observable} from \"rxjs\";\n\n/**\n * An interface used by a component to describe what dynamic event it can send\n */\nexport interface DynamicEventSource {\n  name:string;\n  type:DynamicEventType;\n  eventSource:Observable<DynamicEvent>;\n}\n\nexport class BaseDynamicEventSource implements DynamicEventSource{\n\n  constructor(public name:string, public type:DynamicEventType, public eventSource:Observable<DynamicEvent>) {\n  }\n}\n\nexport enum DynamicEventType {\n  VALUE_CHANGE = 'VALUE_CHANGE',\n  SELECTION_CHANGE='SELECTION_CHANGE'\n}\n\n/**\n * A dynamic event sent by one component to another\n */\nexport interface DynamicEvent {\n  name:string;\n  type:DynamicEventType;\n  value:any;\n}\n\nexport class BaseDynamicEvent implements DynamicEvent{\n\n  constructor(public name:string, public type:DynamicEventType, public value:any) {\n  }\n}\n","import {\n  ChangeDetectionStrategy,\n  Component,\n  EventEmitter,\n  Optional,\n  Output,\n  TemplateRef,\n  ViewChild\n} from \"@angular/core\";\nimport {DontCodeModelManager, DontCodeStoreManager, dtcde} from \"@dontcode/core\";\nimport {AbstractDynamicComponent} from \"./abstract-dynamic-component\";\nimport {PossibleTemplateList, TemplateList} from \"./template-list\";\nimport {firstValueFrom, lastValueFrom, Observable} from \"rxjs\";\nimport {map} from \"rxjs/operators\";\nimport {\n  BaseDynamicEvent,\n  BaseDynamicEventSource,\n  DynamicEvent,\n  DynamicEventSource,\n  DynamicEventType\n} from \"./dynamic-event\";\n\n/**\n * A Component that let the user select from a list of entities\n */\n@Component({\n  selector: 'dontcode-reference',\n  templateUrl: './abstract-reference.component.html',\n  styleUrls: ['./abstract-reference.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n  }\n)\nexport class AbstractReferenceComponent extends AbstractDynamicComponent {\n\n  @ViewChild('inlineView',{static:true})\n  private inlineView!: TemplateRef<any>;\n\n  @ViewChild('fullEditView',{static:true})\n  private fullEditView!: TemplateRef<any>;\n\n  @Output()\n  valueChange = new EventEmitter<DynamicEvent>();\n\n  /**\n   * The json path to list the entities, ending with the property to use as a key and display (for example: $.creation.sources.name), to be provided by derived classes\n   * @protected\n   */\n  protected targetEntitiesPos:string|null = null;\n\n  protected targetEntitiesProperty:string|null = null;\n\n  options = new Array<string>();\n\n  constructor(@Optional() protected modelMgr:DontCodeModelManager, @Optional() protected storeMgr:DontCodeStoreManager) {\n    super();\n      // When loaded by Federation, sometimes the dtcde components are not injected.\n    if (modelMgr==null) this.modelMgr=dtcde.getModelManager();\n    if (storeMgr==null) this.storeMgr=dtcde.getStoreManager();\n  }\n\n  canProvide(key?: string): PossibleTemplateList {\n    return new PossibleTemplateList(true, false, true);\n  }\n\n  providesTemplates(key?: string): TemplateList {\n    return new TemplateList (this.inlineView, null, this.fullEditView);\n  }\n\n  protected setTargetEntitiesWithName (entityName:string, propertyName?:string): Promise<boolean> {\n\n    // We must find the list of possible shops\n    const queryResult=this.modelMgr.queryModelToSingle(\"$.creation.entities[?(@.name=='\"+entityName+\"')]\");\n    if( queryResult==null) {\n      console.error(\"Cannot find an entity with name \"+entityName+\" in the model.\");\n      throw new Error (\"Cannot find an entity with name \"+entityName+\" in the model.\");\n    }\n    this.targetEntitiesPos = queryResult.pointer;\n\n    if (this.targetEntitiesPos==null)  return Promise.resolve(false);\n    else {\n      this.targetEntitiesProperty= propertyName??null;\n      return firstValueFrom(this.possibleValues()).then(value => {\n        this.options=value;\n        return true;\n      });\n    }\n  }\n\n  possibleValues (): Observable<Array<string>> {\n    if (this.targetEntitiesPos==null)  throw new Error ('Missing query of target entity for class '+this.constructor.name);\n    const models=this.storeMgr.searchEntities(this.targetEntitiesPos);\n\n    if (this.targetEntitiesProperty!=null){\n      const property=this.targetEntitiesProperty;\n      return models.pipe(\n        map((loadedModels)=> {\n          return loadedModels.map((model) => model[property]);\n      }));\n    } else return models;\n  }\n\n  override listEventSources(): DynamicEventSource[] {\n    const ret= super.listEventSources();\n    ret.push(\n      new BaseDynamicEventSource (\"Value\", DynamicEventType.VALUE_CHANGE, this.valueChange.asObservable())\n    );\n    return ret;\n  }\n\n  valueChanged($event: any):void {\n    this.valueChange.emit(new BaseDynamicEvent(\"Value\", DynamicEventType.VALUE_CHANGE, $event.value));\n  }\n\n  override setValue(val: any) {\n   if ((val!=null) && (this.options!=null) && (this.options.findIndex((value) => {\n     return value == val;\n   })==-1)) {\n     if( this.options[0]!=='Error') {\n      // throw new Error (\"erferf\");\n     }\n     if ( this.options[1] != null) {\n       val=this.options[1].toString();\n     } else {\n       //throw new Error (\"ERerferf\");\n     }\n/*     if( (typeof val ==='string')&&(val!=='Shop EP')&&(val!=='Shop GW')) {\n       throw new Error (\"Error of the death\");\n     } else if (typeof val !== 'string') {\n       throw new Error (\"Error of the death\");\n     }*/\n     /*if( this.counter>=1) {\n     }*/\n    }\n    super.setValue(val);\n  }\n\n}\n","import {\n  Action,\n  ActionHandler,\n  Change,\n  CommandProviderInterface,\n  DontCodeModelPointer,\n  PreviewHandler\n} from \"@dontcode/core\";\nimport {Subscription} from \"rxjs\";\nimport {PluginHandlerHelper} from \"./plugin-handler-helper\";\n\n/**\n * Helps develop a plugin handler that is not an Angular Component. For an Angular Component handling model changes, please use PluginBaseComponent\n */\nexport abstract class AbstractPluginHandler implements PreviewHandler, ActionHandler {\n  protected subscriptions = new Subscription();\n  protected pluginHelper = new PluginHandlerHelper();\n  protected entityPointer: DontCodeModelPointer | null = null\n  protected provider: CommandProviderInterface | null = null;\n\n  protected unsubscribe(): void {\n    this.pluginHelper.unsubscribe();\n    this.subscriptions.unsubscribe();\n  }\n\n  initCommandFlow(provider: CommandProviderInterface, pointer: DontCodeModelPointer): any {\n    this.entityPointer = pointer;\n    this.provider = provider;\n    this.pluginHelper.initCommandFlow(provider, pointer, this);\n  }\n\n  protected initChangeListening() {\n    this.pluginHelper.initChangeListening();\n  }\n\n  /**\n   * When the component is created for display, it receives the initial data as complete Json.\n   * If it wants, it can call this method who will call handleChange for each property.\n   * This will avoid to duplicate code (first time when a complete json is sent, second when subelements are sent)\n   * @protected\n   */\n  protected decomposeJsonToMultipleChanges(pointer: DontCodeModelPointer, json: any): void {\n    this.pluginHelper.decomposeJsonToMultipleChanges(pointer, json);\n  }\n\n  /**\n   * Updates the array of T elements by applying the changes received and calling the transform method\n   * @param cols\n   * @param colsMap\n   * @param change\n   * @param property\n   * @param transform\n   * @private\n   */\n  applyUpdatesToArray<T>(target: T[], targetMap: Map<string, number>, change: Change, property: string, transform: (position: DontCodeModelPointer, item: any) => T, applyProperty?: (target: T, key: string, value: any) => boolean): Promise<T[]> {\n    return this.applyUpdatesToArrayAsync(target, targetMap, change, property, (key, item) => {\n      return Promise.resolve( transform(key, item));\n    } );\n  }\n\n  /**\n   * Updates the array of T elements by applying the changes received and calling the transform method\n   * @param target\n   * @param targetMap\n   * @param change\n   * @param property\n   * @param transform\n   * @param parentPosition\n   * @param applyProperty\n   * @private\n   */\n  applyUpdatesToArrayAsync<T>(target: T[], targetMap: Map<string, number>, change: Change, property: string|null, transform: (position: DontCodeModelPointer, item: any) => Promise<T>,\n                              parentPosition?: string, applyProperty?: (target: T, key: string|null, value: any) => boolean): Promise<T[]> {\n    return this.pluginHelper.applyUpdatesToArrayAsync(target, targetMap, change, property, transform, parentPosition, applyProperty);\n  }\n\n  /**\n   * This is where components react to changes received\n   * @param change\n   * @protected\n   */\n  abstract handleChange(change: Change): void;\n\n  /**\n   * Called whenever an action needs to be performed on the data\n   * @param action\n   */\n  performAction(action: Action): Promise<void> {\n    return Promise.resolve(undefined);\n  }\n\n}\n","import {Injectable} from '@angular/core';\nimport {\n  DontCodeModelManager, DontCodeModelPointer,\n  DontCodeReportGroupType,\n  DontCodeReportSortType,\n  DontCodeStoreCriteria,\n  DontCodeStoreGroupby,\n  DontCodeStoreManager,\n  DontCodeStorePreparedEntities,\n  StoreProviderHelper\n} from \"@dontcode/core\";\nimport {map} from \"rxjs/operators\";\nimport {firstValueFrom} from \"rxjs\";\nimport {DontCodeDataTransformer} from \"@dontcode/core/src/lib/store/dont-code-data-transformer\";\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EntityStoreService {\n\n  protected listsByPosition = new Map<string, EntityListManager<any>> ();\n  constructor(protected storeMgr:DontCodeStoreManager, protected modelMgr:DontCodeModelManager) { }\n\n  retrieveListManager<T=never> (pointer:DontCodeModelPointer, description:any, ): EntityListManager<T> {\n    let newOne:EntityListManager<any>|undefined = this.listsByPosition.get(pointer.position);\n    if (newOne == null){\n      newOne = new EntityListManager<T>(pointer, description, this.storeMgr, this.modelMgr);\n      this.listsByPosition.set(pointer.position, newOne);\n    }\n    return newOne;\n  }\n}\n\n/**\n * Manages a list of any object stored by the Dont-Code StoreManager in a way that Angular detects the changes\n */\nexport class EntityListManager<T=never> {\n  protected pointer: DontCodeModelPointer;\n  protected description:any;\n  /**\n   * The array of entities to use\n   */\n  entities: T[]|null = null;\n  prepared : DontCodeStorePreparedEntities<T>|null = null;\n\n  constructor(pointer:DontCodeModelPointer, description: any, protected storeMgr:DontCodeStoreManager, protected modelMgr:DontCodeModelManager) {\n    this.pointer = pointer;\n    this.description = description;\n  }\n\n  push (element:T):void {\n    if (this.entities==null)\n      this.entities=new Array<T>(element);\n    else\n      this.entities = [...this.entities, element];\n  }\n\n  updateWithDetailedEntity (element:T):T {\n    const elementId=(element as any)._id;\n    const updated = new Array<T>();\n    if (this.entities!=null) {\n      this.entities.forEach(value => {\n        const valueId=(value as any)._id;\n        if( valueId==elementId) {\n          element={...element, ...value};\n          updated.push(element);\n        }else {\n          updated.push(value);\n        }\n      })\n      this.entities = [...updated];\n    } else {\n      this.entities = [element];\n    }\n    return element;\n  }\n\n  replace (element:T):boolean {\n    if (this.entities==null) return false;\n\n    const elementId=(element as any)._id;\n    let ret=false;\n    const updated = new Array<T>();\n    this.entities.forEach(value => {\n      const valueId=(value as any)._id;\n      if( valueId==elementId) {\n        updated.push(element);\n        ret = true;\n      }else {\n        updated.push(value);\n      }\n    })\n    this.entities = [...updated];\n    return ret;\n  }\n\n  remove (element:T): Promise<boolean> {\n    if (this.entities==null) return Promise.resolve(false);\n\n    const elementId=(element as any)._id;\n    if (elementId==null)  // Not saved yet, so just remove it from the list\n    {\n      return new Promise (resolve => {\n        if (this.entities!=null) {\n          this.entities = this.entities.filter(val => (val!==element));\n          this.prepared=null;\n          resolve( true);\n        } else resolve (false);\n      });\n    }else {\n    return this.storeMgr.deleteEntity(this.pointer.position, elementId).then(deleted => {\n      if( deleted) {\n        if (this.entities!=null) {\n          this.entities = this.entities.filter(val => (val!==element));\n          this.prepared=null;\n        }\n      }\n      return deleted;\n    }).catch((reason:Error) => {\n      console.error(reason.message);\n      return false;\n    });\n    }\n  }\n\n  reset (): void {\n    if( this.entities!=null)\n      this.entities.length=0;\n    this.prepared=null;\n  }\n\n  store (element:any): Promise<any> {\n    this.prepared=null;\n    return this.storeMgr.storeEntity(this.pointer.position, element);\n  }\n\n  /**\n   * Saves permanently all elements that have been changed\n   */\n  async storeAllChanged (): Promise<any> {\n    if (this.entities==null) return;\n\n    this.prepared=null;\n    for (const entity of this.entities) {\n      await this.storeMgr.storeEntity(this.pointer.position, entity);\n    }\n  }\n\n  loadAll (): Promise<void> {\n    return firstValueFrom(this.storeMgr.searchEntities(this.pointer.position).pipe(\n      map (values => {\n        this.prepared=null;\n        this.entities = [...values];\n      return;\n    })\n    ), {defaultValue:undefined});\n  }\n\n  searchAndPrepareEntities(\n    sort?:{[key:string]:DontCodeReportSortType}|undefined,\n    groupBy?:{[key:string]:DontCodeReportGroupType}|undefined,\n    dataTransformer?:DontCodeDataTransformer,\n    ...criteria: DontCodeStoreCriteria[]\n  ): Promise<void> {\n      // It only supports one groupby and one sortby for now, so just find one if any\n    let listOfValues:any[] = (sort!=null)?Object.values(sort):[];\n    const sortStore = (listOfValues.length>0)?listOfValues[0]:undefined;\n    listOfValues=(groupBy!=null)?Object.values(groupBy):[];\n    const groupByStore= (listOfValues.length>0)?new DontCodeStoreGroupby(listOfValues[0].of,listOfValues[0].display, listOfValues[0].show):undefined;\n    if (this.entities!=null) {\n      this.prepared=null;\n      // Already loaded, just sort & group\n      let sortedValues= this.entities;\n      let groupedValues=undefined;\n\n      if( criteria!=null)\n        sortedValues=StoreProviderHelper.applyFilters(sortedValues, ...criteria);\n      if( dataTransformer!=null) {\n        sortedValues= dataTransformer.postLoadingTransformation(sortedValues);\n      }\n      if (sortStore!=null){\n        sortedValues=StoreProviderHelper.multiSortArray(sortedValues,sortStore);\n      }\n      if (groupByStore!=null){\n        groupedValues=StoreProviderHelper.calculateGroupedByValues(sortedValues, groupByStore, this.modelMgr, this.pointer);\n      }\n      if ((criteria!=null) || (sort!=null) || (groupBy!=null)) {\n        this.prepared=new DontCodeStorePreparedEntities<any>(sortedValues, sortStore, groupedValues);\n      }\n      this.entities=sortedValues; // Updates the list with sorted and modified values\n      return Promise.resolve();\n    } else {\n      // Not loaded already, just ask the store to do it\n      return firstValueFrom(this.storeMgr.searchAndPrepareEntities(this.pointer.position, sortStore, groupByStore, dataTransformer, ...criteria).pipe(\n        map (value => {\n          this.prepared=value;\n          this.entities=this.prepared.sortedData;\n        }))\n      )\n    }\n  }\n\n\n  /**\n   * Loads the detail of an already loaded item. Makes sure it only add any additional fields without changing any values of the item in memory\n   * @param toLoad\n   */\n  loadDetailFromKey (key:any): Promise<any> {\n    if( key==null)\n      return Promise.reject(\"Cannot load entity with null key\");\n    return this.storeMgr.loadEntity(this.pointer.position, key).then(loaded => {\n      if (loaded!=null) {\n        return this.updateWithDetailedEntity(loaded);\n      }\n      return loaded;\n    });\n  }\n    /**\n   * Loads the detail of an already loaded item.\n   * @param toLoad\n   */\n  loadDetailOf (toLoad:any): Promise<any> {\n    return this.loadDetailFromKey(toLoad._id);\n  }\n}\n","import {Change, DontCodeModelManager, DontCodeSchemaItem, ModelQuerySingleResult} from \"@dontcode/core\";\nimport {Injectable} from \"@angular/core\";\n\n/**\n * Stores and constantly updates the json (as an instance of the DontCodeSchema) as it is being edited / modified through Change events\n * It's a wrapper around DontCodeModelManager\n * It does not store the entity values but the description of entities, screens... as defined in the Editor\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ValueService {\n\n  constructor(protected modelMgr:DontCodeModelManager) {\n  }\n\n  getContent(): any {\n    return this.modelMgr.getContent();\n  }\n\n  /**\n   * Resets the current json content to the one given in parameter\n   * @param newContent\n   */\n  resetContent(newContent: any): void {\n    this.modelMgr.resetContent(newContent);\n  }\n  /**\n   * Subscribes to the Subject in parameter to receive model updates through changes.\n   * Changes are generated by the Editor as the user modifies the application.\n   * It then modifies it's internal json to be up to date.\n   * @param receivedCommands\n   * @deprecated in favor of applyChange\n   */\n/*  receiveUpdatesFrom(receivedCommands: Subject<Change>): void {\n    this.model.receiveUpdatesFrom(receivedCommands);\n  }\n*/\n  /**\n   * Apply the change to the model and returns the list of subchanges implied by it\n   * @param chg\n   */\n/*  applyChange (chg: Change): Change[] {\n    return this.modelMgr.applyChange(chg);\n  }*/\n  /**\n   * Provides the json extract at the given position.\n   * For example, findAtPosition ('creation/entities/a') will returns the description (fields...) of the first entity created with the editor\n   * @param position\n   * @param create\n   */\n  findAtPosition(position: string, create?: boolean): any {\n    return this.modelMgr.findAtPosition(position, create);\n  }\n\n  /**\n   * Enable querying the model for any value, following jsonPath model\n   * To use when potentially you expect multiple values\n   * @param query: the query as a jsonPath\n   * @param position: in case the jsonPath is relative\n   */\n  queryModelToArray(query: string, position?: string): Array<any> {\n    return this.modelMgr.queryModelToArray(query, position);\n  }\n\n  /**\n   * Enable querying the model for any value, following jsonPath model\n   * To use when potentially you expect a single value.\n   * @param query: the query as a  jsonPath\n   * @param position: in case the jsonPath is relative\n   */\n  queryModelToSingle(query: string, position?: string): ModelQuerySingleResult|null {\n    return this.modelMgr.queryModelToSingle(query, position);\n  }\n\n  /**\n   * Returns the list of values that are possible target of a given property path. With this the Builder User Interface can display to the user a combo-box will all targets\n   * For example, with the following model:\n   * \"from\": {\n   *           \"type\": \"string\",\n   *           \"format\": \"$.creation.sources.name\"\n   *         }\n   *\n   * findAllPossibleTargetsOrProperty (\"from\", ...) will returns all sources names.\n   * @param property\n   * @param position\n   * @param schemaItem\n   */\n  findAllPossibleTargetsOfProperty(\n    property: string,\n    position: string,\n    schemaItem?: DontCodeSchemaItem\n  ): Array<any> {\n    return this.modelMgr.findAllPossibleTargetsOfProperty(property, position, schemaItem);\n  }\n\n  /**\n   * Returns the exact element that matches the target of a given property path.\n   *\n   * For example, with the following Dont-code model:\n   * \"from\": {\n   *           \"type\": \"string\",\n   *           \"format\": \"$.creation.sources.name\"\n   *         }\n   *\n   * and an instantiated model like this:\n   * {\n   *   \"from\": \"EntityName\"\n   * }\n   * findAllPossibleTargetsOrProperty (\"from\", ...) will return only the source named \"EntityName\".\n   * @param property\n   * @param position\n   * @param schemaItem\n   */\n  findTargetOfProperty(\n    property: string,\n    position: string,\n    schemaItem?: DontCodeSchemaItem\n  ): ModelQuerySingleResult|null {\n    return this.modelMgr.findTargetOfProperty(property, position, schemaItem);\n    }\n\n  }\n","import {Inject, InjectionToken, Optional} from \"@angular/core\";\nimport {MenuItem} from \"primeng/api\";\n\nexport interface CommonLibConfig {\n  webSocketUrl?: string;\n  ideWebSocketUrl?: string;\n  projectApiUrl?: string;\n  storeApiUrl?:string;\n  documentApiUrl?:string;\n  indexedDbName?: string;\n  applicationName?: string;\n  theme?: string;\n  templateFileUrl?: string;\n}\n\n\n/*export const basicStoreApiUrlConfig = (config:CommonLibConfig) => {\n  return config.storeUrl;\n};\n\nexport const basicDocumentApiUrlConfig = (config:CommonLibConfig) => {\n  return config.documentUrl;\n};*/\n\nexport const CHANNEL_CHANGE_NAME='preview-ui-changes';\n\n/**\n * Allows application to add any menu\n */\nexport interface MenuUpdater {\n  additionalMenus (): MenuItem[];\n}\n\nexport const SANDBOX_MENUS = new InjectionToken<MenuUpdater>('Allows addition of menus');\n","import { Inject, Injectable, Optional } from \"@angular/core\";\nimport { CommonLibConfig } from \"./common-lib-config\";\nimport { Observable, ReplaySubject, Subject } from \"rxjs\";\nimport { DONT_CODE_COMMON_CONFIG } from \"../common-global/globals\";\n\n/**\n * A service storing configuration information.\n * Configuration can be changed after loading\n */\n@Injectable({\n    providedIn: 'root',\n  })\n  export class CommonConfigService {\n      protected config: CommonLibConfig;\n      protected updates = new ReplaySubject<Readonly<CommonLibConfig>> (1);\n\n      constructor (@Optional() @Inject(DONT_CODE_COMMON_CONFIG) config: CommonLibConfig) {\n        this.config = config;\n        if( this.config==null) this.config={};\n      }\n\n      getConfig (): Readonly<CommonLibConfig> {\n        return this.config;\n      }\n      getUpdates (): Observable<Readonly<CommonLibConfig>> {\n        return this.updates;\n      }\n      \n      updateConfig (property:keyof CommonLibConfig, value:any) {\n        this.config[property]=value;\n        this.updates.next (this.config);\n      }\n\n      batchUpdateConfig (newValues: {[P in keyof CommonLibConfig]:any}) {\n        this.config = Object.assign(this.config, newValues);\n        this.updates.next (this.config);\n      }\n  }  ","import {ModuleWithProviders, NgModule} from '@angular/core';\nimport {DynamicInsertPoint} from \"./common-ui/abstract-dynamic-loader-component\";\nimport {\n  DontCodeChangeManager,\n  DontCodeModelManager,\n  DontCodePreviewManager,\n  DontCodeSchemaManager,\n  DontCodeStoreManager,\n  dtcde\n} from \"@dontcode/core\";\nimport {DONT_CODE_CORE} from \"./common-global/globals\";\nimport {BeautifierPipe} from './common-ui/pipes/beautifier.pipe';\nimport {DropdownModule} from \"primeng/dropdown\";\nimport {ReactiveFormsModule} from \"@angular/forms\";\nimport {CommonModule} from \"@angular/common\";\nimport {AbstractReferenceComponent} from \"./common-ui/abstract-reference.component\";\n\n@NgModule({\n  imports: [CommonModule, DropdownModule, ReactiveFormsModule],\n  declarations: [DynamicInsertPoint, BeautifierPipe, AbstractReferenceComponent],\n  exports: [DynamicInsertPoint, BeautifierPipe, AbstractReferenceComponent]\n})\nexport class PluginCommonModule {\n  /**\n   * Injects the DontCode core components into Angular's Dependency injection\n   * @param config\n   */\n  static forRoot(): ModuleWithProviders<PluginCommonModule> {\n    return {\n      ngModule: PluginCommonModule,\n      providers: [\n        {provide:DONT_CODE_CORE, useValue: dtcde},\n        {provide:DontCodeSchemaManager, useValue:dtcde.getSchemaManager()},\n        {provide:DontCodeModelManager, useValue:dtcde.getModelManager()},\n        {provide:DontCodePreviewManager, useValue:dtcde.getPreviewManager()},\n        {provide:DontCodeStoreManager, useValue:dtcde.getStoreManager()},\n        {provide:DontCodeChangeManager, useValue:dtcde.getChangeManager()},\n        BeautifierPipe\n      ]\n    }\n  }\n}\n\nexport * from './common-global/globals';\nexport * from './common-handler/abstract-plugin-handler';\nexport * from './common-handler/plugin-handler-helper';\nexport * from './common-ui/plugin-base.component';\nexport * from './common-ui/template-list';\nexport * from './common-ui/dynamic-component';\nexport * from './common-ui/dynamic-event';\nexport * from './common-ui/abstract-dynamic-component';\nexport * from './common-ui/abstract-dynamic-loader-component';\nexport * from './common-ui/abstract-reference.component';\nexport * from './common-ui/pipes/beautifier.pipe';\nexport * from './common-storage/entity-store.service';\nexport * from './common-dynamic/component-loader.service';\nexport * from './common-values/value.service';\nexport * from './common-config/common-lib-config';\nexport * from './common-config/common-config.service';","import {ChangeHandlerConfig, Core, DontCodeModel, dtcde, Plugin, PluginConfig} from \"@dontcode/core\";\nimport {ComponentLoaderService} from \"../common-dynamic/component-loader.service\";\nimport {PluginCommonTestModule} from \"../plugin-common-test.module\";\n\n/**\n * In complement of DontCodeTestManager, provides some Angular specific helpers\n */\nexport class CommonTestManager {\n\n  /**\n   * Register a specific component for testing\n   * @param type\n   * @param component\n   * @param cls\n   */\n  public static registerComponentForType(forType: string, name: string, component: any) {\n\n    // Add the config so that ComponentLoaderService finds the component\n    dtcde.registerPlugin(new TestPlugin({forType, name}));\n    PluginCommonTestModule.previewHandlers.set(name, component);\n  }\n}\n\nclass TestPlugin implements Plugin {\n\n  protected testComponents :{forType:string, name:string}|null=null;\n\n\n  constructor(toDeclare:{forType:string, name:string}) {\n    this.testComponents=toDeclare;\n  }\n\n  CONFIG: PluginConfig={\n    plugin: {\n      id:'CommonTestManagerPlugin',\n      version:'1.0'\n    },\n    'schema-updates': [{\n      id: 'test-component',\n      description: 'Test Component added',\n      changes: [{\n        location: {\n          parent: '#/$defs/field',\n          id: 'type'\n        },\n        update: {\n          enum: [{\n            Test: {\n              enum: [\n              ]\n            }\n          }\n          ]\n        },\n        replace: false\n      }]\n    }],\n\n    \"preview-handlers\": []\n  }\n\n  PREVIEW_HANDLER_CONFIG: ChangeHandlerConfig={\n    location: {\n      parent: DontCodeModel.APP_FIELDS,\n      id: 'type',\n      values: [{\n        Test: {\n          enum: [\n          ]\n        }\n      }]\n    },\n    class: {\n      source:'common-test-module',\n      name:'name'\n    }\n  };\n\ngetConfiguration(): PluginConfig {\n  if (this.testComponents!=null) {\n    const ret = structuredClone(this.CONFIG) as PluginConfig;\n    const previewConfig = structuredClone(this.PREVIEW_HANDLER_CONFIG) as ChangeHandlerConfig;\n    if( (ret[\"schema-updates\"]!=null) && (ret[\"preview-handlers\"]!=null)) {\n      ret[\"schema-updates\"][0].id = this.testComponents.name;\n      ret[\"schema-updates\"][0].changes[0].update.enum[0].Test.enum.push(this.testComponents.forType);\n\n      previewConfig.class.name=this.testComponents.name;\n      previewConfig.location.values[0].Test.enum.push(this.testComponents.forType);\n      ret[\"preview-handlers\"].push(previewConfig);\n      return ret;\n    }\n  }\n  throw new Error (\"No testComponent to register\");\n}\n\n  pluginInit(dontCode: Core): void {\n  }\n\n}\n","import {NgModule} from '@angular/core';\nimport {CommonModule} from \"@angular/common\";\nimport {PluginModuleInterface} from \"@dontcode/core\";\nimport {PluginCommonModule} from \"./plugin-common.module\";\n\n@NgModule({\n  imports: [CommonModule, PluginCommonModule],\n  declarations: [],\n  exports: [],\n  id:'dontcode-plugin/common-test-module'\n})\nexport class PluginCommonTestModule  implements PluginModuleInterface{\n  public static previewHandlers = new Map<string, any>();\n  exposedPreviewHandlers(): Map<string, any> {\n    return PluginCommonTestModule.previewHandlers;\n  }\n}\n\nexport * from './common-test/common-test-manager';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n","const E_TIMEOUT = new Error('timeout while waiting for mutex to become available');\nconst E_ALREADY_LOCKED = new Error('mutex already locked');\nconst E_CANCELED = new Error('request for lock canceled');\n\nvar __awaiter$2 = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nclass Semaphore {\n    constructor(_value, _cancelError = E_CANCELED) {\n        this._value = _value;\n        this._cancelError = _cancelError;\n        this._weightedQueues = [];\n        this._weightedWaiters = [];\n    }\n    acquire(weight = 1) {\n        if (weight <= 0)\n            throw new Error(`invalid weight ${weight}: must be positive`);\n        return new Promise((resolve, reject) => {\n            if (!this._weightedQueues[weight - 1])\n                this._weightedQueues[weight - 1] = [];\n            this._weightedQueues[weight - 1].push({ resolve, reject });\n            this._dispatch();\n        });\n    }\n    runExclusive(callback, weight = 1) {\n        return __awaiter$2(this, void 0, void 0, function* () {\n            const [value, release] = yield this.acquire(weight);\n            try {\n                return yield callback(value);\n            }\n            finally {\n                release();\n            }\n        });\n    }\n    waitForUnlock(weight = 1) {\n        if (weight <= 0)\n            throw new Error(`invalid weight ${weight}: must be positive`);\n        return new Promise((resolve) => {\n            if (!this._weightedWaiters[weight - 1])\n                this._weightedWaiters[weight - 1] = [];\n            this._weightedWaiters[weight - 1].push(resolve);\n            this._dispatch();\n        });\n    }\n    isLocked() {\n        return this._value <= 0;\n    }\n    getValue() {\n        return this._value;\n    }\n    setValue(value) {\n        this._value = value;\n        this._dispatch();\n    }\n    release(weight = 1) {\n        if (weight <= 0)\n            throw new Error(`invalid weight ${weight}: must be positive`);\n        this._value += weight;\n        this._dispatch();\n    }\n    cancel() {\n        this._weightedQueues.forEach((queue) => queue.forEach((entry) => entry.reject(this._cancelError)));\n        this._weightedQueues = [];\n    }\n    _dispatch() {\n        var _a;\n        for (let weight = this._value; weight > 0; weight--) {\n            const queueEntry = (_a = this._weightedQueues[weight - 1]) === null || _a === void 0 ? void 0 : _a.shift();\n            if (!queueEntry)\n                continue;\n            const previousValue = this._value;\n            const previousWeight = weight;\n            this._value -= weight;\n            weight = this._value + 1;\n            queueEntry.resolve([previousValue, this._newReleaser(previousWeight)]);\n        }\n        this._drainUnlockWaiters();\n    }\n    _newReleaser(weight) {\n        let called = false;\n        return () => {\n            if (called)\n                return;\n            called = true;\n            this.release(weight);\n        };\n    }\n    _drainUnlockWaiters() {\n        for (let weight = this._value; weight > 0; weight--) {\n            if (!this._weightedWaiters[weight - 1])\n                continue;\n            this._weightedWaiters[weight - 1].forEach((waiter) => waiter());\n            this._weightedWaiters[weight - 1] = [];\n        }\n    }\n}\n\nvar __awaiter$1 = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nclass Mutex {\n    constructor(cancelError) {\n        this._semaphore = new Semaphore(1, cancelError);\n    }\n    acquire() {\n        return __awaiter$1(this, void 0, void 0, function* () {\n            const [, releaser] = yield this._semaphore.acquire();\n            return releaser;\n        });\n    }\n    runExclusive(callback) {\n        return this._semaphore.runExclusive(() => callback());\n    }\n    isLocked() {\n        return this._semaphore.isLocked();\n    }\n    waitForUnlock() {\n        return this._semaphore.waitForUnlock();\n    }\n    release() {\n        if (this._semaphore.isLocked())\n            this._semaphore.release();\n    }\n    cancel() {\n        return this._semaphore.cancel();\n    }\n}\n\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nfunction withTimeout(sync, timeout, timeoutError = E_TIMEOUT) {\n    return {\n        acquire: (weight) => {\n            if (weight !== undefined && weight <= 0) {\n                throw new Error(`invalid weight ${weight}: must be positive`);\n            }\n            return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {\n                let isTimeout = false;\n                const handle = setTimeout(() => {\n                    isTimeout = true;\n                    reject(timeoutError);\n                }, timeout);\n                try {\n                    const ticket = yield sync.acquire(weight);\n                    if (isTimeout) {\n                        const release = Array.isArray(ticket) ? ticket[1] : ticket;\n                        release();\n                    }\n                    else {\n                        clearTimeout(handle);\n                        resolve(ticket);\n                    }\n                }\n                catch (e) {\n                    if (!isTimeout) {\n                        clearTimeout(handle);\n                        reject(e);\n                    }\n                }\n            }));\n        },\n        runExclusive(callback, weight) {\n            return __awaiter(this, void 0, void 0, function* () {\n                let release = () => undefined;\n                try {\n                    const ticket = yield this.acquire(weight);\n                    if (Array.isArray(ticket)) {\n                        release = ticket[1];\n                        return yield callback(ticket[0]);\n                    }\n                    else {\n                        release = ticket;\n                        return yield callback();\n                    }\n                }\n                finally {\n                    release();\n                }\n            });\n        },\n        release(weight) {\n            sync.release(weight);\n        },\n        cancel() {\n            return sync.cancel();\n        },\n        waitForUnlock: (weight) => {\n            if (weight !== undefined && weight <= 0) {\n                throw new Error(`invalid weight ${weight}: must be positive`);\n            }\n            return new Promise((resolve, reject) => {\n                sync.waitForUnlock(weight).then(resolve);\n                setTimeout(() => reject(timeoutError), timeout);\n            });\n        },\n        isLocked: () => sync.isLocked(),\n        getValue: () => sync.getValue(),\n        setValue: (value) => sync.setValue(value),\n    };\n}\n\n// eslint-disable-next-lisne @typescript-eslint/explicit-module-boundary-types\nfunction tryAcquire(sync, alreadyAcquiredError = E_ALREADY_LOCKED) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return withTimeout(sync, 0, alreadyAcquiredError);\n}\n\nexport { E_ALREADY_LOCKED, E_CANCELED, E_TIMEOUT, Mutex, Semaphore, tryAcquire, withTimeout };\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n      args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n      _next(undefined);\n    });\n  };\n}"],"names":["Subject","dateTimestampProvider","ReplaySubject","constructor","_bufferSize","Infinity","_windowTime","_timestampProvider","_infiniteTimeWindow","Math","max","next","value","isStopped","_buffer","push","now","_trimBuffer","_subscribe","subscriber","_throwIfClosed","subscription","_innerSubscribe","copy","slice","i","length","closed","_checkFinalizedStatuses","adjustedBufferSize","splice","last","Observable","Subscription","EMPTY_SUBSCRIPTION","ObjectUnsubscribedError","arrRemove","errorContext","lift","operator","subject","AnonymousSubject","currentObservers","Array","from","observers","observer","error","err","hasError","thrownError","shift","complete","unsubscribe","observed","_trySubscribe","asObservable","observable","source","destination","subscribe","EmptyError","SafeSubscriber","firstValueFrom","config","hasConfig","Promise","resolve","reject","defaultValue","EMPTY","empty","scheduler","emptyScheduled","schedule","popScheduler","of","args","innerFrom","createOperatorSubscriber","operate","catchError","selector","innerSub","syncUnsub","handledResult","undefined","takeLast","count","buffer","delegate","Date","createErrorClass","_super","EmptyErrorImpl","name","message","ObjectUnsubscribedErrorImpl","isFunction","isScheduler","arr","popResultSelector","pop","popNumber","AbstractDynamicComponent","setName","getValue","form","updateValueFromForm","setValue","val","hydrateValueToForm","setParentPosition","position","parentPosition","setForm","createAndRegisterFormControls","getForm","control","FormControl","updateOn","registerControl","transformToFormGroupValue","transformFromFormGroupValue","get","Error","formValue","emitEvent","dirty","markAsPristine","onlySelf","toBeautifyString","maxLength","ret","isArray","toLocaleDateString","JSON","stringify","toLocaleString","substring","listEventSources","selectEventSourceFor","type","sources","src","ngOnDestroy","subscriptions","Component","template","COMMAND_PROVIDER","InjectionToken","DONT_CODE_CORE","DONT_CODE_COMMON_CONFIG","ComponentLoaderService","injector","dontCodeCore","previewMgr","provider","Map","Mutex","getOrCreatePluginModuleRef","moduleSource","mutex","acquire","then","release","moduleRef","moduleMap","createNgModule","getNgModuleById","set","loadPluginModule","handlerConfig","class","initPlugins","insertComponentForFieldType","insertPoint","insertComponent","schemaPosition","currentJson","schemaPos","positionInSchema","isPointer","getJsonAt","retrieveHandlerConfig","componentClass","instance","exposedPreviewHandlers","createComponent","catch","reason","console","componentRef","ngModuleRef","component","initCommandFlow","registerModuleForTest","module","Injectable","providedIn","Inject","Optional","DynamicInsertPoint","Directive","AbstractDynamicLoaderComponent","loader","ref","defineSubField","propertyAndFormName","newSubField","SubFieldInfo","addSubField","getSubField","pos","fieldsMap","fields","toAdd","getSubFields","formGroup","FormGroup","parentForm","preloadSubFields","key","controls","isChanged","element","setSubFieldValue","subFieldValue","getSubFieldValue","subFieldFullEditTemplate","subField","subInfo","providesTemplates","forFullEdit","subFieldInlineViewTemplate","forInlineView","subFieldFullViewTemplate","forFullView","loadSubField","subValue","dynamicInsertPoint","prepareComponent","singleVal","updatedValue","patchValue","loadSubComponent","formName","componentInited","applyComponentToSubField","info","ngAfterViewInit","detectCheckDone","valueSafe","detectChanges","ViewContainerRef","ViewChild","read","static","comp","PluginHandlerHelper","pointer","changeHandler","actionPerformer","entityPointer","performAction","decomposeJsonToMultipleChanges","json","change","schemaManager","getSchemaManager","prop","hasOwnProperty","subPropertyPointer","generateSubSchemaPointer","propType","locateItem","isProperty","Change","ChangeType","RESET","handleChange","initChangeListening","subElement","initOtherChangeListening","filter","add","receiveCommands","pipe","map","actionType","action","running","applyUpdatesToArray","target","targetMap","property","transform","applyProperty","applyUpdatesToArrayAsync","item","runExclusive","calculatePointerFor","subItem","containerPosition","itemId","lastElement","DontCodeModelPointer","lastElementOf","propertyId","futureTarget","newTarget","targetPos","has","beforeKey","ADD","UPDATE","fullValue","parentPointer","MOVE","forEach","delete","DELETE","result","size","sendCommand","PluginBaseComponent","pluginHelper","updateValueOnFormChanges","valueChanges","decodeStringField","updateSubFieldsWithChange","subProperty","elt","newVal","DontCodeModel","APP_FIELDS_NAME_NODE","updatedFields","rebuildForm","toRemove","Set","formKey","field","Validators","required","removeControl","BeautifierPipe","Pipe","pure","TemplateList","PossibleTemplateList","BaseDynamicEventSource","eventSource","DynamicEventType","BaseDynamicEvent","AbstractReferenceComponent","storeMgr","modelMgr","EventEmitter","dtcde","getModelManager","getStoreManager","canProvide","inlineView","fullEditView","setTargetEntitiesWithName","entityName","propertyName","queryResult","queryModelToSingle","targetEntitiesPos","targetEntitiesProperty","possibleValues","options","models","searchEntities","loadedModels","model","VALUE_CHANGE","valueChange","valueChanged","$event","emit","findIndex","toString","i2","changeDetection","ChangeDetectionStrategy","OnPush","Output","AbstractPluginHandler","EntityStoreService","retrieveListManager","description","newOne","listsByPosition","EntityListManager","entities","updateWithDetailedEntity","elementId","_id","updated","valueId","replace","remove","prepared","deleteEntity","deleted","reset","store","storeEntity","storeAllChanged","entity","loadAll","values","searchAndPrepareEntities","sort","groupBy","dataTransformer","criteria","listOfValues","Object","sortStore","groupByStore","DontCodeStoreGroupby","display","show","sortedValues","groupedValues","StoreProviderHelper","applyFilters","postLoadingTransformation","multiSortArray","calculateGroupedByValues","DontCodeStorePreparedEntities","sortedData","loadDetailFromKey","loadEntity","loaded","loadDetailOf","toLoad","ValueService","getContent","resetContent","newContent","findAtPosition","create","queryModelToArray","query","findAllPossibleTargetsOfProperty","schemaItem","findTargetOfProperty","CHANNEL_CHANGE_NAME","SANDBOX_MENUS","CommonConfigService","getConfig","getUpdates","updates","updateConfig","batchUpdateConfig","newValues","assign","PluginCommonModule","forRoot","ngModule","providers","provide","useValue","DontCodeSchemaManager","DontCodeModelManager","DontCodePreviewManager","getPreviewManager","DontCodeStoreManager","DontCodeChangeManager","getChangeManager","CommonModule","DropdownModule","ReactiveFormsModule","NgModule","imports","declarations","exports","CommonTestManager","registerComponentForType","forType","registerPlugin","TestPlugin","PluginCommonTestModule","previewHandlers","toDeclare","plugin","id","version","changes","location","parent","update","enum","Test","APP_FIELDS","testComponents","getConfiguration","structuredClone","CONFIG","previewConfig","PREVIEW_HANDLER_CONFIG","pluginInit","dontCode","E_TIMEOUT","E_ALREADY_LOCKED","E_CANCELED","__awaiter$2","__awaiter","thisArg","_arguments","P","generator","adopt","fulfilled","step","e","rejected","done","apply","Semaphore","_value","_cancelError","_weightedQueues","_weightedWaiters","weight","_dispatch","callback","waitForUnlock","isLocked","cancel","queue","entry","_a","queueEntry","previousValue","previousWeight","_newReleaser","_drainUnlockWaiters","called","waiter","__awaiter$1","cancelError","_semaphore","releaser","withTimeout","sync","timeout","timeoutError","isTimeout","handle","setTimeout","ticket","clearTimeout","tryAcquire","alreadyAcquiredError"],"sourceRoot":"webpack:///","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,31,32]}